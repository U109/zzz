(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{336:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"é¢ç»æ‰‹å†Œ-Â·-ç¬¬15ç¯‡ã€Šç å†œä¼šé”-synchronized-è§£æ¯’-å‰–ææºç æ·±åº¦åˆ†æ-ã€‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¢ç»æ‰‹å†Œ-Â·-ç¬¬15ç¯‡ã€Šç å†œä¼šé”-synchronized-è§£æ¯’-å‰–ææºç æ·±åº¦åˆ†æ-ã€‹"}},[s._v("#")]),s._v(" é¢ç»æ‰‹å†Œ Â· ç¬¬15ç¯‡ã€Šç å†œä¼šé”ï¼Œsynchronized è§£æ¯’ï¼Œå‰–ææºç æ·±åº¦åˆ†æï¼ã€‹")]),s._v(" "),t("p",[s._v("ä½œè€…ï¼šå°å‚…å“¥\n"),t("br"),s._v("åšå®¢ï¼š"),t("a",{attrs:{href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://bugstack.cn"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")])]),s._v(" "),t("h2",{attrs:{id:"ä¸€ã€å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€å‰è¨€"}},[s._v("#")]),s._v(" ä¸€ã€å‰è¨€")]),s._v(" "),t("p",[t("code",[s._v("æ„Ÿè§‰ä»€ä¹ˆéƒ½ä¸ä¼šï¼Œä»å“ªå¼€å§‹å‘€ï¼")])]),s._v(" "),t("p",[s._v("è¿™æ˜¯æœ€è¿‘æˆ‘æ€»èƒ½è¢«é—®åˆ°çš„é—®é¢˜ï¼Œä¹Ÿç¡®å®æ˜¯ã€‚ä¸€ä¸ªåˆå…¥ç¼–ç¨‹èŒåœºçš„æ–°äººï¼Œæˆ–æ˜¯ä¸€ä¸ªæƒ³é‡æ–°åŠªåŠ›å­¦ä¹ çš„è€å¸æœºï¼Œè¿™ä¹Ÿä¸ä¼šï¼Œé‚£ä¹Ÿä¸ä¼šï¼Œæ€»ä¼šçŠ¯æ„ä»å“ªå¼€å§‹ã€‚")]),s._v(" "),t("p",[s._v("è®²é“ç†ï¼Œæ¯•ç«Ÿ Java æ¶‰åŠçš„çŸ¥è¯†å¤ªå¤šäº†ï¼Œè¦å­¦åº”è¯¥æ˜¯å­¦ä¼šå­¦ä¹ çš„èƒ½åŠ›ï¼Œè€Œä¸æ˜¯å»èƒŒé¢˜ã€èƒŒç­”æ¡ˆï¼Œæ‹¾äººç‰™æ…§æ˜¯ä¸ä¼šæœ‰å¤ªå¤šæ”¶ç›Šçš„ã€‚")]),s._v(" "),t("p",[s._v("å­¦ä¹ çš„è¿‡ç¨‹è¦æ‰¾å¯¹æ–¹æ³•ï¼Œé‡åˆ°é—®é¢˜æ—¶æœ€å¥½èƒ½è‡ªå·±æƒ³æƒ³ï¼Œä½ æœ‰å“ªäº›æ–¹å¼å­¦ä¼šè¿™äº›çŸ¥è¯†ã€‚æ˜¯ä¸æ„Ÿè§‰å³ä½¿è®©ä½ å»ç™¾åº¦æœï¼Œä½ éƒ½ä¸çŸ¥é“åº”è¯¥æ‹¿å“ªä¸ªå…³é”®å­—æœï¼åªèƒ½æ‹¿ç€é—®é¢˜ç›´æ¥æ‰¾äººé—®ï¼Œè¿™æ ·ç¼ºå°‘æ€è€ƒï¼Œç¼ºå°‘å¤§è„‘æ’å—å¢™çš„è¿‡ç¨‹ï¼Œå…¶å®æœ€åä¹Ÿå¾ˆéš¾å­¦ä¼šã€‚")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ï¼Œä½ è¦å­¦ä¼šçš„æ˜¯è‡ªæˆ‘å­¦ä¹ çš„èƒ½åŠ›ï¼Œä¹‹åæ˜¯ä»å“ªå¼€å§‹éƒ½å¯ä»¥ï¼Œé‡è¦çš„æ˜¯å¼€å§‹å’ŒåšæŒï¼")]),s._v(" "),t("h2",{attrs:{id:"äºŒã€é¢è¯•é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€é¢è¯•é¢˜"}},[s._v("#")]),s._v(" äºŒã€é¢è¯•é¢˜")]),s._v(" "),t("p",[t("code",[s._v("è°¢é£æœºï¼Œå°è®°")]),s._v("ï¼Œå‘¨æœ«é€›å®Œå¥¥ç‰¹è±æ–¯ï¼Œå›æ¥å°±è·‘é¢è¯•å®˜å®¶å»äº†ï¼")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šduangã€duangã€duangï¼Œæˆ‘æ¥äº†ï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šæ¥çš„è¿˜æŒºå‡†æ—¶ï¼Œæ´—æ´—æ‰‹åƒé¥­å§ï¼")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå˜¿å˜¿...")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šä½ çœ‹æˆ‘è¿™å—é±¼è±†è…ï¼Œåƒä¸åƒ synchronized é”ï¼")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå•Šï¼ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šé£æœºï¼Œæ­£å¥½é—®ä½ ã€‚synchronizedã€volatileï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å‘€ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå—¯ï¼Œvolatile ä¿è¯å¯è§æ€§ï¼Œsynchronized ä¿è¯åŸå­æ€§ï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šé‚£ä¸ç”¨ volatileï¼Œåªç”¨ synchronized ä¿®é¥°æ–¹å¼ï¼Œèƒ½ä¿è¯å¯è§æ€§å—ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šè¿™...ï¼Œæˆ‘æ²¡éªŒè¯è¿‡ï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šåƒå§ï¼Œåƒå§ï¼ä¸€ä¼šç»™ä½ ä¸ª synchronized å­¦ä¹ å¤§çº²ï¼Œç…§ç€æ•´ç†çŸ¥è¯†ç‚¹ï¼")]),s._v(" "),t("h2",{attrs:{id:"ä¸‰ã€synchronized-è§£æ¯’"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€synchronized-è§£æ¯’"}},[s._v("#")]),s._v(" ä¸‰ã€synchronized è§£æ¯’")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-0 é¢è¯•å®˜ç»™è°¢é£æœºçš„ï¼Œsynchronized å­¦ä¹ å¤§çº²","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-00.png",loading:"lazy"}})]),s._v(" "),t("h3",{attrs:{id:"_1-å¯¹è±¡ç»“æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¯¹è±¡ç»“æ„"}},[s._v("#")]),s._v(" 1. å¯¹è±¡ç»“æ„")]),s._v(" "),t("h4",{attrs:{id:"_1-1-å¯¹è±¡ç»“æ„ä»‹ç»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-å¯¹è±¡ç»“æ„ä»‹ç»"}},[s._v("#")]),s._v(" 1.1 å¯¹è±¡ç»“æ„ä»‹ç»")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-1 64ä½JVMå¯¹è±¡ç»“æ„æè¿°","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-01.png",loading:"lazy"}})]),s._v(" "),t("p",[t("strong",[s._v("HotSpotè™šæ‹Ÿæœº")]),s._v(" markOop.cpp ä¸­çš„ C++ ä»£ç æ³¨é‡Šç‰‡æ®µï¼Œæè¿°äº† 64bits ä¸‹ mark-word çš„å­˜å‚¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯å›¾ 15-1 çš„ç»“æ„ç¤ºæ„ã€‚")]),s._v(" "),t("p",[s._v("è¿™éƒ¨åˆ†çš„æºç æ³¨é‡Šå¦‚ä¸‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bits"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\nunused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" hash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" unused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    biased_lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("normal object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JavaThread")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v(" epoch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" unused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    biased_lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("biased object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PromotedObject")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" promo_bits"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CMS")]),s._v(" promoted object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CMS")]),s._v(" free block"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nunused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" hash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cms_free"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    biased_lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("COOPs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" normal object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JavaThread")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v(" epoch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" cms_free"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    biased_lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("COOPs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" biased object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnarrowOop"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" unused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" cms_free"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" unused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" promo_bits"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("COOPs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CMS")]),s._v(" promoted object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nunused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cms_free"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" unused"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("COOPs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CMS")]),s._v(" free block"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("em",[s._v("æºç åœ°å€")]),s._v("ï¼š"),t("a",{attrs:{href:"http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/87ee5ee27509/src/share/vm/oops/markOop.hpp",target:"_blank",rel:"noopener noreferrer"}},[s._v("jdk8/hotspot/file/vm/oops/markOop.hpp"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("HotSpotè™šæ‹Ÿæœºä¸­")]),s._v("ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼š"),t("code",[s._v("å¯¹è±¡å¤´ï¼ˆHeaderï¼‰")]),s._v("ã€"),t("code",[s._v("å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰")]),s._v("å’Œ"),t("code",[s._v("å¯¹é½å¡«å……ï¼ˆPaddingï¼‰")]),s._v("ã€‚")]),s._v(" "),t("ul",[t("li",[s._v("mark-wordï¼šå¯¹è±¡æ ‡è®°å­—æ®µå 8ä¸ªå­—èŠ‚ï¼Œç”¨äºå­˜å‚¨ä¸€äº›åˆ—çš„æ ‡è®°ä½ï¼Œæ¯”å¦‚ï¼šå“ˆå¸Œå€¼ã€è½»é‡çº§é”çš„æ ‡è®°ä½ï¼Œåå‘é”æ ‡è®°ä½ã€åˆ†ä»£å¹´é¾„ç­‰ã€‚")]),s._v(" "),t("li",[s._v("Klass Pointerï¼šClasså¯¹è±¡çš„ç±»å‹æŒ‡é’ˆï¼ŒJdk1.8é»˜è®¤å¼€å¯æŒ‡é’ˆå‹ç¼©åä¸º4å­—èŠ‚ï¼Œå…³é—­æŒ‡é’ˆå‹ç¼©ï¼ˆ"),t("code",[s._v("-XX:-UseCompressedOops")]),s._v("ï¼‰åï¼Œé•¿åº¦ä¸º8å­—èŠ‚ã€‚å…¶æŒ‡å‘çš„ä½ç½®æ˜¯å¯¹è±¡å¯¹åº”çš„Classå¯¹è±¡ï¼ˆå…¶å¯¹åº”çš„å…ƒæ•°æ®å¯¹è±¡ï¼‰çš„å†…å­˜åœ°å€ã€‚")]),s._v(" "),t("li",[s._v("å¯¹è±¡å®é™…æ•°æ®ï¼šåŒ…æ‹¬å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œå¤§å°ç”±å„ä¸ªæˆå‘˜å˜é‡å†³å®šï¼Œæ¯”å¦‚ï¼šbyteå 1ä¸ªå­—èŠ‚8æ¯”ç‰¹ä½ã€intå 4ä¸ªå­—èŠ‚32æ¯”ç‰¹ä½ã€‚")]),s._v(" "),t("li",[s._v("å¯¹é½ï¼šæœ€åè¿™æ®µç©ºé—´è¡¥å…¨å¹¶éå¿…é¡»ï¼Œä»…ä»…ä¸ºäº†èµ·åˆ°å ä½ç¬¦çš„ä½œç”¨ã€‚ç”±äºHotSpotè™šæ‹Ÿæœºçš„å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰€ä»¥å¯¹è±¡å¤´æ­£å¥½æ˜¯8å­—èŠ‚çš„å€æ•°ã€‚å› æ­¤å½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("å¦å¤–")]),s._v("ï¼Œåœ¨mark-wordé”ç±»å‹æ ‡è®°ä¸­ï¼Œæ— é”ï¼Œåå‘é”ï¼Œè½»é‡é”ï¼Œé‡é‡é”ï¼Œä»¥åŠGCæ ‡è®°ï¼Œ5ç§ç±»ä¸­æ²¡æ³•ç”¨2æ¯”ç‰¹æ ‡è®°ï¼ˆ2æ¯”ç‰¹æœ€ç»ˆæœ‰4ç§ç»„åˆ"),t("code",[s._v("00")]),s._v("ã€"),t("code",[s._v("01")]),s._v("ã€"),t("code",[s._v("10")]),s._v("ã€"),t("code",[s._v("11")]),s._v("ï¼‰ï¼Œæ‰€ä»¥æ— é”ã€åå‘é”ï¼Œå‰åˆå äº†ä¸€ä½åå‘é”æ ‡è®°ã€‚æœ€ç»ˆï¼š001ä¸ºæ— é”ã€101ä¸ºåå‘é”ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_1-2-éªŒè¯å¯¹è±¡ç»“æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-éªŒè¯å¯¹è±¡ç»“æ„"}},[s._v("#")]),s._v(" 1.2 éªŒè¯å¯¹è±¡ç»“æ„")]),s._v(" "),t("p",[s._v("ä¸ºäº†å¯ä»¥æ›´åŠ ç›´è§‚çš„çœ‹åˆ°å¯¹è±¡ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© "),t("code",[s._v("openjdk")]),s._v(" æä¾›çš„ "),t("code",[s._v("jol-core")]),s._v(" è¿›è¡Œæ‰“å°åˆ†æã€‚")]),s._v(" "),t("p",[t("strong",[s._v("å¼•å…¥POM")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" https"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mvnrepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("artifact"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jol"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jol"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cli "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jol"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jol"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cli"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.14")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("æµ‹è¯•ä»£ç ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("current")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("details")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" åå…­è¿›åˆ¶å“ˆå¸Œï¼š"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toHexString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLayout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toPrintable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"_1-2-1-æŒ‡é’ˆå‹ç¼©å¼€å¯-é»˜è®¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-æŒ‡é’ˆå‹ç¼©å¼€å¯-é»˜è®¤"}},[s._v("#")]),s._v(" 1.2.1 æŒ‡é’ˆå‹ç¼©å¼€å¯(é»˜è®¤)")]),s._v(" "),t("p",[t("strong",[s._v("è¿è¡Œç»“æœ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Running")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bit "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HotSpot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Using")]),s._v(" compressed oop "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bit shift"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Using")]),s._v(" compressed klass "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bit shift"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Objects")]),s._v(" are "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" bytes aligned"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Field")]),s._v(" sizes by type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Array")]),s._v(" element sizes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Object")]),s._v(" object internals"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OFFSET")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIZE")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TYPE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DESCRIPTION")]),s._v("                               "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VALUE")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           e5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" f8 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11100101")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11111000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217243")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loss due "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("the")]),s._v(" next object alignment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Instance")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" bytes\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Space")]),s._v(" losses"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes internal "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" bytes external "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" bytes total\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-2 æŒ‡é’ˆå‹ç¼©å¼€å¯ï¼Œå¯¹è±¡å¤´å¸ƒå±€","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-02.png",loading:"lazy"}})]),s._v(" "),t("ul",[t("li",[s._v("Objectå¯¹è±¡ï¼Œæ€»å…±å 16å­—èŠ‚")]),s._v(" "),t("li",[s._v("å¯¹è±¡å¤´å  12 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ï¼šmark-down å  8 å­—èŠ‚ã€Klass Point å  4 å­—èŠ‚")]),s._v(" "),t("li",[s._v("æœ€å 4 å­—èŠ‚ï¼Œç”¨äºæ•°æ®å¡«å……æ‰¾é½")])]),s._v(" "),t("h5",{attrs:{id:"_1-2-2-æŒ‡é’ˆå‹ç¼©å…³é—­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-æŒ‡é’ˆå‹ç¼©å…³é—­"}},[s._v("#")]),s._v(" 1.2.2 æŒ‡é’ˆå‹ç¼©å…³é—­")]),s._v(" "),t("p",[s._v("åœ¨ "),t("code",[s._v("Run--\x3eEdit Configurations->VM Options")]),s._v(" é…ç½®å‚æ•° "),t("code",[s._v("-XX:-UseCompressedOops")]),s._v(" å…³é—­æŒ‡é’ˆå‹ç¼©ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è¿è¡Œç»“æœ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Object")]),s._v(" object internals"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OFFSET")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIZE")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TYPE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DESCRIPTION")]),s._v("                               "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VALUE")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00010010")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00001100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01010011")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1393299969")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000010")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("c b9 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("b "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00011100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10111001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00011011")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("465116160")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Instance")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" bytes\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Space")]),s._v(" losses"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes internal "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes external "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes total\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-3 æŒ‡é’ˆå‹ç¼©å…³é—­ï¼Œå¯¹è±¡å¤´å¸ƒå±€","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-03.png",loading:"lazy"}})]),s._v(" "),t("ul",[t("li",[s._v("å…³é—­æŒ‡é’ˆå‹ç¼©åï¼Œmark-word è¿˜æ˜¯å  8 å­—èŠ‚ä¸å˜ã€‚")]),s._v(" "),t("li",[s._v("é‡ç‚¹åœ¨ç±»å‹æŒ‡é’ˆ Klass Point çš„å˜åŒ–ï¼Œç”±åŸæ¥çš„ 4 å­—èŠ‚ï¼Œç°åœ¨æ‰©å¢åˆ° 8 å­—èŠ‚ã€‚")])]),s._v(" "),t("h5",{attrs:{id:"_1-2-3-å¯¹è±¡å¤´å“ˆå¸Œå€¼å­˜å‚¨éªŒè¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-å¯¹è±¡å¤´å“ˆå¸Œå€¼å­˜å‚¨éªŒè¯"}},[s._v("#")]),s._v(" 1.2.3 å¯¹è±¡å¤´å“ˆå¸Œå€¼å­˜å‚¨éªŒè¯")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è°ƒæ•´ä¸‹æµ‹è¯•ä»£ç ï¼Œçœ‹ä¸‹å“ˆå¸Œå€¼åœ¨å¯¹è±¡å¤´ä¸­å…·ä½“æ˜¯æ€ä¹ˆå­˜æ”¾çš„ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("æµ‹è¯•ä»£ç ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("current")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("details")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" åå…­è¿›åˆ¶å“ˆå¸Œï¼š"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toHexString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLayout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toPrintable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("æ”¹åŠ¨ä¸å¤šï¼Œåªæ˜¯æŠŠå“ˆå¸Œå€¼å’Œå¯¹è±¡æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬éªŒè¯å¯¹è±¡å¤´å…³äºå“ˆå¸Œå€¼çš„å­˜æ”¾ç»“æœã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("è¿è¡Œç»“æœ")])]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-3 å¯¹è±¡å¤´å“ˆå¸Œå€¼å­˜æ”¾","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-04.png",loading:"lazy"}})]),s._v(" "),t("ul",[t("li",[s._v("å¦‚å›¾ 15-3ï¼Œå¯¹è±¡çš„å“ˆå¸Œå€¼æ˜¯16è¿›åˆ¶çš„ï¼Œ"),t("code",[s._v("0x2530c12")])]),s._v(" "),t("li",[s._v("åœ¨å¯¹è±¡å¤´å“ˆå¸Œå€¼å­˜æ”¾çš„ç»“æœä¸Šçœ‹ï¼Œä¹Ÿæœ‰å¯¹åº”çš„æ•°å€¼ã€‚åªä¸è¿‡è¿™ä¸ªç»“æœæ˜¯å€’è¿‡æ¥çš„ã€‚")])]),s._v(" "),t("p",[s._v("å…³äºè¿™ä¸ªå€’è¿‡æ¥çš„é—®é¢˜æ˜¯å› ä¸ºï¼Œå¤§å°ç«¯å­˜å‚¨å¯¼è‡´ï¼›")]),s._v(" "),t("ul",[t("li",[s._v("Big-Endianï¼šé«˜ä½å­—èŠ‚å­˜æ”¾äºå†…å­˜çš„ä½åœ°å€ç«¯ï¼Œä½ä½å­—èŠ‚å­˜æ”¾äºå†…å­˜çš„é«˜åœ°å€ç«¯")]),s._v(" "),t("li",[s._v("Little-Endianï¼šä½ä½å­—èŠ‚å­˜æ”¾äºå†…å­˜çš„ä½åœ°å€ç«¯ï¼Œé«˜ä½å­—èŠ‚å­˜æ”¾äºå†…å­˜çš„é«˜åœ°å€ç«¯")])]),s._v(" "),t("p",[t("strong",[s._v("mark-downç»“æ„")])]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-5 æ— é”çŠ¶æ€ï¼Œ64ä½è™šæ‹Ÿæœºmark-downç»“æ„","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-05.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("å¦‚å›¾ 15-5 æœ€å³ä¾§çš„ 3 Bitï¼ˆ1 Bitæ ‡è¯†åå‘é”ï¼Œ2 Bitæè¿°é”çš„ç±»å‹ï¼‰æ˜¯è·Ÿé”ç±»å‹å’ŒGCæ ‡è®°ç›¸å…³çš„ï¼Œè€Œ synchronized çš„é”ä¼˜åŒ–å‡çº§è†¨èƒ€å°±æ˜¯ä¿®æ”¹çš„è¿™ä¸‰ä½ä¸Šçš„æ ‡è¯†ï¼Œæ¥åŒºåˆ†ä¸åŒçš„é”ç±»å‹ã€‚ä»è€Œé‡‡å–ä¸åŒçš„ç­–ç•¥æ¥æå‡æ€§èƒ½ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_1-3-monitor-å¯¹è±¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-monitor-å¯¹è±¡"}},[s._v("#")]),s._v(" 1.3 Monitor å¯¹è±¡")]),s._v(" "),t("p",[s._v("åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œmonitoræ˜¯ç”±C++ä¸­ObjectMonitorå®ç°ã€‚")]),s._v(" "),t("p",[s._v("synchronized çš„è¿è¡Œæœºåˆ¶ï¼Œå°±æ˜¯å½“ JVM ç›‘æµ‹åˆ°å¯¹è±¡åœ¨ä¸åŒçš„ç«äº‰çŠ¶å†µæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°é€‚åˆçš„é”å®ç°ï¼Œè¿™ç§åˆ‡æ¢å°±æ˜¯é”çš„å‡çº§ã€é™çº§ã€‚")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆä¸‰ç§ä¸åŒçš„ Monitor å®ç°ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ä¸‰ç§ä¸åŒçš„é”ï¼šåæ–œé”ï¼ˆBiased Lockingï¼‰ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚å½“ä¸€ä¸ª Monitor è¢«æŸä¸ªçº¿ç¨‹æŒæœ‰åï¼Œå®ƒä¾¿å¤„äºé”å®šçŠ¶æ€ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("Monitor ä¸»è¦æ•°æ®ç»“æ„å¦‚ä¸‹")]),s._v("ï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// initialize the monitor, exception the semaphore, all other fields")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// are simple integers or pointers")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMonitor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    _header       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _count        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®°å½•ä¸ªæ•°")]),s._v("\n    _waiters      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    _recursions   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹é‡å…¥æ¬¡æ•°")]),s._v("\n    _object       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å­˜å‚¨ Monitor å¯¹è±¡")]),s._v("\n    _owner        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒæœ‰å½“å‰çº¿ç¨‹çš„ owner")]),s._v("\n    _WaitSet      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ° _WaitSet")]),s._v("\n    _WaitSetLock  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _Responsible  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _succ         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _cxq          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å•å‘åˆ—è¡¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FreeNext")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _EntryList    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨")]),s._v("\n    _SpinFreq     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _SpinClock    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OwnerIsThread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _previous_owner_tid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[t("em",[s._v("æºç åœ°å€")]),s._v("ï¼š"),t("a",{attrs:{href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/objectMonitor.hpp",target:"_blank",rel:"noopener noreferrer"}},[s._v("jdk8/hotspot/file/vm/runtime/objectMonitor.hpp"),t("OutboundLink")],1)]),s._v(" "),t("ul",[t("li",[s._v("ObjectMonitorï¼Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼š"),t("code",[s._v("_WaitSet")]),s._v("ã€"),t("code",[s._v("_EntryList")]),s._v("ï¼Œç”¨æ¥ä¿å­˜ ObjectWaiter å¯¹è±¡åˆ—è¡¨ã€‚")]),s._v(" "),t("li",[s._v("_ownerï¼Œè·å– Monitor å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥ _owner åŒºæ—¶ï¼Œ  _count + 1ã€‚å¦‚æœçº¿ç¨‹è°ƒç”¨äº† wait() æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾ Monitor å¯¹è±¡ï¼Œ _owner æ¢å¤ä¸ºç©ºï¼Œ _count - 1ã€‚åŒæ—¶è¯¥ç­‰å¾…çº¿ç¨‹è¿›å…¥ _WaitSet ä¸­ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("é”ğŸ”’æ‰§è¡Œæ•ˆæœå¦‚ä¸‹")]),s._v("ï¼š")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-06ï¼Œé”ğŸ”’æ‰§è¡Œæ•ˆæœ","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-06.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("å¦‚å›¾ 15-06ï¼Œæ¯ä¸ª Java å¯¹è±¡å¤´ä¸­éƒ½åŒ…æ‹¬ Monitor å¯¹è±¡(å­˜å‚¨çš„æŒ‡é’ˆçš„æŒ‡å‘)ï¼Œsynchronized ä¹Ÿå°±æ˜¯é€šè¿‡è¿™ä¸€ç§æ–¹å¼è·å–é”ï¼Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆ synchronized() æ‹¬å·é‡Œæ”¾ä»»ä½•å¯¹è±¡éƒ½èƒ½è·å¾—é”ğŸ”’ï¼")]),s._v(" "),t("h3",{attrs:{id:"_2-synchronized-ç‰¹æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-synchronized-ç‰¹æ€§"}},[s._v("#")]),s._v(" 2. synchronized ç‰¹æ€§")]),s._v(" "),t("h4",{attrs:{id:"_2-1-åŸå­æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-åŸå­æ€§"}},[s._v("#")]),s._v(" 2.1 åŸå­æ€§")]),s._v(" "),t("p",[t("strong",[s._v("åŸå­æ€§")]),s._v("æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("æ¡ˆä¾‹ä»£ç ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" counter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰10ä¸ªçº¿ç¨‹è¿è¡Œå®Œæ¯•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("counter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    counter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("è¿™æ®µä»£ç å¼€å¯äº† 10 ä¸ªçº¿ç¨‹æ¥ç´¯åŠ  counterï¼ŒæŒ‰ç…§é¢„æœŸç»“æœåº”è¯¥æ˜¯ 100000ã€‚ä½†å®é™…è¿è¡Œä¼šå‘ç°ï¼Œcounter å€¼æ¯æ¬¡è¿è¡Œéƒ½å°äº 10000ï¼Œè¿™æ˜¯å› ä¸º volatile å¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥æœ€åçš„ç»“æœä¸ä¼šæ˜¯10000ã€‚")]),s._v(" "),t("p",[s._v("ä¿®æ”¹æ–¹æ³• add()ï¼Œæ·»åŠ  synchronizedï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicityTest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        counter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("è¿™å›æµ‹è¯•ç»“æœå°±æ˜¯ï¼š100000 äº†ï¼")]),s._v(" "),t("p",[s._v("å› ä¸º synchronized å¯ä»¥ä¿è¯ç»Ÿä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‹¿åˆ°é”ï¼Œè¿›å…¥åˆ°ä»£ç å—æ‰§è¡Œã€‚")]),s._v(" "),t("p",[t("strong",[s._v("åç¼–è¯‘æŸ¥çœ‹æŒ‡ä»¤ç ")])]),s._v(" "),t("p",[t("code",[s._v("javap -v -p AtomicityTest")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    descriptor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v("\n    flags"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACC_PUBLIC")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACC_STATIC")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Code")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      stack"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" locals"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ldc           #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// class org/itstack/interview/AtomicityTest")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" dup\n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" astore_0\n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" monitorenter\n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" getstatic     #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Field counter:I")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" iconst_1\n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" iadd\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" putstatic     #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Field counter:I")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" aload_0\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" monitorexit\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("goto")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" astore_1\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" aload_0\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" monitorexit\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" aload_1\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" athrow\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" table"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[t("strong",[s._v("åŒæ­¥æ–¹æ³•")])]),s._v(" "),t("p",[t("code",[s._v("ACC_SYNCHRONIZED")]),s._v(" è¿™æ˜¯ä¸€ä¸ªåŒæ­¥æ ‡è¯†ï¼Œå¯¹åº”çš„16è¿›åˆ¶å€¼æ˜¯ 0x0020")]),s._v(" "),t("p",[s._v("è¿™10ä¸ªçº¿ç¨‹è¿›å…¥è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ¤æ–­æ˜¯å¦æœ‰æ­¤æ ‡è¯†ï¼Œç„¶åå¼€å§‹ç«äº‰ Monitor å¯¹è±¡ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("åŒæ­¥ä»£ç ")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("monitorenter")]),s._v("ï¼Œåœ¨åˆ¤æ–­æ‹¥æœ‰åŒæ­¥æ ‡è¯† "),t("code",[s._v("ACC_SYNCHRONIZED")]),s._v(" æŠ¢å…ˆè¿›å…¥æ­¤æ–¹æ³•çš„çº¿ç¨‹ä¼šä¼˜å…ˆæ‹¥æœ‰ Monitor çš„ owner ï¼Œæ­¤æ—¶è®¡æ•°å™¨ +1ã€‚")]),s._v(" "),t("li",[t("code",[s._v("monitorexit")]),s._v("ï¼Œå½“æ‰§è¡Œå®Œé€€å‡ºåï¼Œè®¡æ•°å™¨ -1ï¼Œå½’ 0 åè¢«å…¶ä»–è¿›å…¥çš„çº¿ç¨‹è·å¾—ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_2-2-å¯è§æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-å¯è§æ€§"}},[s._v("#")]),s._v(" 2.2 å¯è§æ€§")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šä¸€ç« èŠ‚ volatile ç¯‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ã€‚æœ€ç»ˆçš„æ•ˆæœå°±æ˜¯åœ¨æ·»åŠ  volatile çš„å±æ€§å˜é‡æ—¶ï¼Œçº¿ç¨‹Aä¿®æ”¹å€¼åï¼Œçº¿ç¨‹Bä½¿ç”¨æ­¤å˜é‡å¯ä»¥åšå‡ºç›¸åº”çš„ååº”ï¼Œæ¯”å¦‚ "),t("code",[s._v("while(!å˜é‡)")]),s._v(" é€€å‡ºã€‚")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆï¼Œ"),t("code",[s._v("synchronized")]),s._v(" å…·å¤‡å¯è§æ€§å—ï¼Œæˆ‘ä»¬åšç»™ä¾‹å­ã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" sign "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread01")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("sign"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread02")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" ignore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        sign "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vt.sign = true  while (!sign)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread01")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread02")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("è¿™æ˜¯ä¸¤ä¸ªçº¿ç¨‹æ“ä½œä¸€ä¸ªå˜é‡çš„ä¾‹å­ï¼Œå› ä¸ºçº¿ç¨‹é—´å¯¹å˜é‡ "),t("code",[s._v("sign")]),s._v(" çš„ä¸å¯è§æ€§ï¼Œçº¿ç¨‹ Thread01 ä¸­çš„ while (!sign) ä¼šä¸€ç›´æ‰§è¡Œï¼Œä¸ä¼šéšç€çº¿ç¨‹ Thread02 ä¿®æ”¹ sign = true è€Œé€€å‡ºå¾ªç¯ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ç°åœ¨")]),s._v("æˆ‘ä»¬ç»™æ–¹æ³• add æ·»åŠ  "),t("code",[s._v("synchronized")]),s._v(" å…³é”®å­—ä¿®é¥°ï¼Œå¦‚ä¸‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("æ·»åŠ åè¿è¡Œç»“æœ")]),s._v("ï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.849")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itstack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interview"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("VisibilityTest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" vt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sign "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("sign"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Process")]),s._v(" finished "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("exit")]),s._v(" code "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°å½“çº¿ç¨‹ Thread02 æ”¹å˜å˜é‡ sign = true åï¼Œçº¿ç¨‹ Thread01 ç«‹å³é€€å‡ºäº†å¾ªç¯ã€‚")]),s._v(" "),t("p",[t("em",[s._v("æ³¨æ„ï¼šä¸è¦åœ¨æ–¹æ³•ä¸­æ·»åŠ   System.out.println() ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¸­å«æœ‰ synchronized ä¼šå½±å“æµ‹è¯•ç»“æœï¼")])]),s._v(" "),t("p",[t("strong",[s._v("é‚£ä¹ˆä¸ºä»€ä¹ˆæ·»åŠ  synchronized ä¹Ÿèƒ½ä¿è¯å˜é‡çš„å¯è§æ€§å‘¢ï¼Ÿ")])]),s._v(" "),t("p",[s._v("å› ä¸ºï¼š")]),s._v(" "),t("ol",[t("li",[s._v("çº¿ç¨‹è§£é”å‰ï¼Œå¿…é¡»æŠŠå…±äº«å˜é‡çš„æœ€æ–°å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚")]),s._v(" "),t("li",[s._v("çº¿ç¨‹åŠ é”å‰ï¼Œå°†æ¸…ç©ºå·¥ä½œå†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ï¼Œä»è€Œä½¿ç”¨å…±äº«å˜é‡æ—¶éœ€è¦ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–æœ€æ–°çš„å€¼ã€‚")]),s._v(" "),t("li",[s._v("volatile çš„å¯è§æ€§éƒ½æ˜¯é€šè¿‡å†…å­˜å±éšœï¼ˆMemnory Barrierï¼‰æ¥å®ç°çš„ã€‚")]),s._v(" "),t("li",[s._v("synchronized é æ“ä½œç³»ç»Ÿå†…æ ¸äº’æ–¥é”å®ç°ï¼Œç›¸å½“äº JMM ä¸­çš„ lockã€unlockã€‚é€€å‡ºä»£ç å—æ—¶åˆ·æ–°å˜é‡åˆ°ä¸»å†…å­˜ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_2-3-æœ‰åºæ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-æœ‰åºæ€§"}},[s._v("#")]),s._v(" 2.3 æœ‰åºæ€§")]),s._v(" "),t("p",[t("code",[s._v("as-if-serial")]),s._v("ï¼Œä¿è¯ä¸ç®¡ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ä¼šå¦‚ä½•è¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼Œéƒ½éœ€è¦ä¿è¯å•çº¿ç¨‹ä¸‹çš„è¿è¡Œç»“æœçš„æ­£ç¡®æ€§ã€‚ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ï¼š"),t("strong",[s._v("å¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚")])]),s._v(" "),t("p",[s._v("è¿™é‡Œæœ‰ä¸€æ®µåŒé‡æ£€éªŒé”ï¼ˆDouble-checked Lockingï¼‰çš„ç»å…¸æ¡ˆä¾‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    instance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[t("strong",[s._v("ä¸ºä»€ä¹ˆ")]),s._v("ï¼Œsynchronized ä¹Ÿæœ‰å¯è§æ€§çš„ç‰¹ç‚¹ï¼Œè¿˜éœ€è¦ volatile å…³é”®å­—ï¼Ÿ")]),s._v(" "),t("p",[s._v("å› ä¸ºï¼Œsynchronized çš„æœ‰åºæ€§ï¼Œä¸æ˜¯ volatile çš„é˜²æ­¢æŒ‡ä»¤é‡æ’åºã€‚")]),s._v(" "),t("p",[s._v("é‚£å¦‚æœä¸åŠ  volatile å…³é”®å­—å¯èƒ½å¯¼è‡´çš„ç»“æœï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨åˆå§‹åŒ–åˆå§‹åŒ–å¯¹è±¡ï¼Œè®¾ç½® instance æŒ‡å‘å†…å­˜åœ°å€æ—¶ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œæœ‰æŒ‡ä»¤é‡æ’ã€‚åœ¨åˆ¤æ–­ if (instance == null)  æ—¶å°±ä¼šæœ‰å‡ºé”™çš„å¯èƒ½ï¼Œå› ä¸ºè¿™ä¼šå¯èƒ½ instance å¯èƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–æˆåŠŸã€‚")]),s._v(" "),t("h4",{attrs:{id:"_2-4-å¯é‡å…¥æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-å¯é‡å…¥æ€§"}},[s._v("#")]),s._v(" 2.4 å¯é‡å…¥æ€§")]),s._v(" "),t("p",[s._v("synchronized æ˜¯å¯é‡å…¥é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…è®¸ä¸€ä¸ªçº¿ç¨‹äºŒæ¬¡è¯·æ±‚è‡ªå·±æŒæœ‰å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºï¼Œè¿™ç§æƒ…å†µç§°ä¸ºå¯é‡å…¥é”ğŸ”’ã€‚")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆæˆ‘ä»¬å°±å†™ä¸€ä¸ªä¾‹å­ï¼Œæ¥è¯æ˜è¿™æ ·çš„æƒ…å†µã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentryTest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentryTest")]),s._v(" reentry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentryTest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        reentry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"å­ç±»æ–¹æ³•ï¼šReentryTest.doA() ThreadIdï¼š"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"å­ç±»æ–¹æ³•ï¼šReentryTest.doB() ThreadIdï¼š"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"çˆ¶ç±»æ–¹æ³•ï¼šA.doA() ThreadIdï¼š"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[t("strong",[s._v("æµ‹è¯•ç»“æœ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("å­ç±»æ–¹æ³•ï¼š"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentryTest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadId")]),s._v("ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nçˆ¶ç±»æ–¹æ³•ï¼š"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadId")]),s._v("ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nå­ç±»æ–¹æ³•ï¼š"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentryTest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadId")]),s._v("ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Process")]),s._v(" finished "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("exit")]),s._v(" code "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("è¿™æ®µå•ä¾‹ä»£ç æ˜¯é€’å½’è°ƒç”¨å«æœ‰ synchronized é”çš„æ–¹æ³•ï¼Œä»è¿è¡Œæ­£å¸¸çš„æµ‹è¯•ç»“æœçœ‹ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿæ­»é”ã€‚æ‰€æœ‰å¯ä»¥è¯æ˜ synchronized æ˜¯å¯é‡å…¥é”ã€‚")]),s._v(" "),t("p",[s._v("synchronizedé”å¯¹è±¡çš„æ—¶å€™æœ‰ä¸ªè®¡æ•°å™¨ï¼Œä»–ä¼šè®°å½•ä¸‹çº¿ç¨‹è·å–é”çš„æ¬¡æ•°ï¼Œåœ¨æ‰§è¡Œå®Œå¯¹åº”çš„ä»£ç å—ä¹‹åï¼Œè®¡æ•°å™¨å°±ä¼š-1ï¼Œç›´åˆ°è®¡æ•°å™¨æ¸…é›¶ï¼Œå°±é‡Šæ”¾é”äº†ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ä¹‹æ‰€ä»¥")]),s._v("ï¼Œæ˜¯å¯ä»¥é‡å…¥ã€‚æ˜¯å› ä¸º synchronized é”å¯¹è±¡æœ‰ä¸ªè®¡æ•°å™¨ï¼Œä¼šéšç€çº¿ç¨‹è·å–é”å +1 è®¡æ•°ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å -1ï¼Œç›´åˆ°æ¸…é›¶é‡Šæ”¾é”ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_3-é”å‡çº§è¿‡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-é”å‡çº§è¿‡ç¨‹"}},[s._v("#")]),s._v(" 3. é”å‡çº§è¿‡ç¨‹")]),s._v(" "),t("p",[s._v("å…³äº synchronized é”ğŸ”’å‡çº§æœ‰ä¸€å¼ éå¸¸å®Œæ•´çš„å›¾ï¼Œå¯ä»¥å‚è€ƒï¼š")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 15-7 synchronized é”å‡çº§è¿‡ç¨‹","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-15-07.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("synchronized é”æœ‰å››ç§äº¤æ›¿å‡çº§çš„çŠ¶æ€ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§ï¼Œè¿™å‡ ä¸ªçŠ¶æ€éšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_3-1-åå‘é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-åå‘é”"}},[s._v("#")]),s._v(" 3.1 åå‘é”")]),s._v(" "),t("p",[s._v("synchronizeræºç ï¼š"),t("a",{attrs:{href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/synchronizer.cpp",target:"_blank",rel:"noopener noreferrer"}},[s._v("/src/share/vm/runtime/synchronizer.cpp"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// NOTE: must use heavy weight monitor to handle jni monitor exit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectSynchronizer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("jni_exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oop obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("THREAD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TEVENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jni_exit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UseBiasedLocking")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Handle")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h_obj")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("THREAD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BiasedLocking")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("revoke_and_rebias")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("THREAD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h_obj")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mark")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("has_bias_pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"biases should be revoked by now"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMonitor")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" monitor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectSynchronizer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("inflate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("THREAD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// If this thread has locked the object, exit the monitor.  Note:  can't use")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// monitor->check(CHECK); must exit even if an exception is pending.")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("monitor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("THREAD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     monitor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("THREAD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("ul",[t("li",[s._v("UseBiasedLocking æ˜¯ä¸€ä¸ªåå‘é”æ£€æŸ¥ï¼Œ1.6ä¹‹åæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œ1.5ä¸­æ˜¯å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯å‚æ•°æ˜¯ "),t("code",[s._v("XX:-UseBiasedLocking=false")])])]),s._v(" "),t("p",[s._v("åæ–œé”ä¼šå»¶ç¼“ JIT é¢„çƒ­è¿›ç¨‹ï¼Œæ‰€ä»¥å¾ˆå¤šæ€§èƒ½æµ‹è¯•ä¸­ä¼šæ˜¾å¼åœ°å…³é—­åæ–œé”ï¼Œåæ–œé”å¹¶ä¸é€‚åˆæ‰€æœ‰åº”ç”¨åœºæ™¯ï¼Œæ’¤é”€æ“ä½œï¼ˆrevokeï¼‰æ˜¯æ¯”è¾ƒé‡çš„è¡Œä¸ºï¼Œåªæœ‰å½“å­˜åœ¨è¾ƒå¤šä¸ä¼šçœŸæ­£ç«äº‰çš„ synchronized å—å„¿æ—¶ï¼Œæ‰èƒ½ä½“ç°å‡ºæ˜æ˜¾æ”¹å–„ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_3-2-è½»é‡çº§é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-è½»é‡çº§é”"}},[s._v("#")]),s._v(" 3.2 è½»é‡çº§é”")]),s._v(" "),t("p",[s._v("å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚")]),s._v(" "),t("p",[s._v("åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼ŒJVMè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œå®˜æ–¹ç§°ä¹‹ä¸º Displaced Mark Wordã€‚")]),s._v(" "),t("h4",{attrs:{id:"_3-3-è‡ªæ—‹é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-è‡ªæ—‹é”"}},[s._v("#")]),s._v(" 3.3 è‡ªæ—‹é”")]),s._v(" "),t("p",[s._v("è‡ªæ—‹é”æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUã€‚")]),s._v(" "),t("p",[s._v("è‡ªæ—‹é”çš„é»˜è®¤å¤§å°æ˜¯10æ¬¡ï¼Œå¯ä»¥è°ƒæ•´ï¼š"),t("code",[s._v("-XXï¼šPreBlockSpin")])]),s._v(" "),t("p",[s._v("å¦‚æœè‡ªæ—‹næ¬¡å¤±è´¥äº†ï¼Œå°±ä¼šå‡çº§ä¸ºé‡é‡çº§çš„é”ã€‚"),t("code",[s._v("é‡é‡çº§çš„é”ï¼Œåœ¨ 1.3 Monitor å¯¹è±¡ä¸­å·²ç»ä»‹ç»ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_3-4-é”ä¼šé™çº§å—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-é”ä¼šé™çº§å—"}},[s._v("#")]),s._v(" 3.4 é”ä¼šé™çº§å—ï¼Ÿ")]),s._v(" "),t("p",[s._v("ä¹‹å‰ä¸€ç›´äº†è§£åˆ° Java ä¸ä¼šè¿›è¡Œé”é™çº§ï¼Œä½†æœ€è¿‘æ•´ç†äº†å¤§é‡çš„èµ„æ–™å‘ç°é”é™çº§ç¡®å®æ˜¯ä¼šå‘ç”Ÿã€‚")]),s._v(" "),t("p",[t("strong",[s._v("When safepoints are used?")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Below")]),s._v(" are few reasons "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HotSpot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JVM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("initiate")]),s._v(" a safepoint"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Garbage")]),s._v(" collection pauses\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Code")]),s._v(" deoptimization\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Flushing")]),s._v(" code cache\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),s._v(" redefinition "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" hot swap or instrumentation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Biased")]),s._v(" lock revocation\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Various")]),s._v(" debug operation "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" deadlock check or stacktrace dump"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("code",[s._v("Biased lock revocation")]),s._v("ï¼Œå½“ JVM è¿›å…¥å®‰å…¨ç‚¹ "),t("a",{attrs:{href:"http://blog.ragozin.info/2012/10/safepoints-in-hotspot-jvm.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("SafePoint"),t("OutboundLink")],1),s._v("çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥æ˜¯å¦æœ‰é—²ç½®çš„ Monitorï¼Œç„¶åè¯•å›¾è¿›è¡Œé™çº§ã€‚")]),s._v(" "),t("h2",{attrs:{id:"å››ã€æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€æ€»ç»“"}},[s._v("#")]),s._v(" å››ã€æ€»ç»“")]),s._v(" "),t("ul",[t("li",[s._v("æœ¬ç« å…³äº "),t("code",[s._v("synchronized")]),s._v(" é”æ¶‰åŠåˆ°äº†è¾ƒå¤šçš„C++æºç åˆ†æå­¦ä¹ ï¼Œæºç åœ°å€ï¼š"),t("a",{attrs:{href:"https://github.com/JetBrains/jdk8u_hotspot",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/JetBrains/jdk8u_hotspot"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("å…³äºé”çš„ç»†èŠ‚æŒ–æ˜é™¤äº†æœ¬æ–‡æåˆ°çš„è¿˜æœ‰å¾ˆå¤šçŸ¥è¯†ç‚¹å¯ä»¥ç»§ç»­å­¦ä¹ ï¼Œå¯ä»¥ç»“åˆ ifeveã€å¹¶å‘ç¼–ç¨‹ã€æ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºï¼Œç­‰ç³»åˆ—çŸ¥è¯†æ•´ç†ã€‚")]),s._v(" "),t("li",[s._v("å­¦ä¹ è¿‡ç¨‹ä¸­ç»“åˆC++æºä»£ç ä¸­å…³äºé”çš„å®ç°ï¼Œæ›´å®¹æ˜“ç†è§£å¯èƒ½åŸæœ¬æ™¦æ¶©éš¾æ‡‚çš„æ¦‚å¿µã€‚åœ¨ç»“åˆå®é™…çš„æ¡ˆä¾‹éªŒè¯ï¼Œä¼šå®¹æ˜“æ¥å—è¿™éƒ¨åˆ†çŸ¥è¯†ã€‚")]),s._v(" "),t("li",[s._v("å¥½äº†ï¼Œè¿™ç¯‡å°±å†™åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœæœ‰è§‚ç‚¹å’Œæ–‡ç« ä¸å‡†ç¡®çš„è¡¨è¾¾æ¬¢è¿ç•™è¨€ï¼Œäº’ç›¸å­¦ä¹ ï¼Œäº’ç›¸æ‰«ç›²ï¼Œäº’ç›¸è¿›æ­¥ã€‚")])]),s._v(" "),t("h2",{attrs:{id:"äº”ã€å‚…è¯—ä¸€æ‰‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€å‚…è¯—ä¸€æ‰‹"}},[s._v("#")]),s._v(" äº”ã€å‚…è¯—ä¸€æ‰‹")]),s._v(" "),t("ul",[t("li",[s._v("ä¼šæ‰€ğŸ¢ï¼Œé‡Œçš„ç å†œä¼šé”ã€‚")]),s._v(" "),t("li",[s._v("æ‹¥æŒ¤ğŸ¤¼â€â™‚ï¸ï¼Œå°±éœ€åŠ ä»·å‡çº§ã€‚")]),s._v(" "),t("li",[s._v("é¡¹ç›®ğŸ¤¯ï¼ŒæŒ‰æ‘©å¯¹è±¡å¤´çš®ã€‚")]),s._v(" "),t("li",[s._v("æ•ˆæœğŸ¤¨ï¼Œå¯è§åŸå­æœ‰åºã€‚")])])])}),[],!1,null,null,null);t.default=e.exports}}]);