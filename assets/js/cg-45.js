(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{337:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"é¢ç»æ‰‹å†Œ-Â·-ç¬¬16ç¯‡ã€Šç å†œä¼šé”-reentrantlockä¹‹å…¬å¹³é”è®²è§£å’Œå®ç°ã€‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¢ç»æ‰‹å†Œ-Â·-ç¬¬16ç¯‡ã€Šç å†œä¼šé”-reentrantlockä¹‹å…¬å¹³é”è®²è§£å’Œå®ç°ã€‹"}},[s._v("#")]),s._v(" é¢ç»æ‰‹å†Œ Â· ç¬¬16ç¯‡ã€Šç å†œä¼šé”ï¼ŒReentrantLockä¹‹å…¬å¹³é”è®²è§£å’Œå®ç°ã€‹")]),s._v(" "),t("p",[s._v("ä½œè€…ï¼šå°å‚…å“¥\n"),t("br"),s._v("åšå®¢ï¼š"),t("a",{attrs:{href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://bugstack.cn"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")])]),s._v(" "),t("h2",{attrs:{id:"ä¸€ã€å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€å‰è¨€"}},[s._v("#")]),s._v(" ä¸€ã€å‰è¨€")]),s._v(" "),t("p",[t("code",[s._v("Javaå­¦å¤šå°‘æ‰èƒ½æ‰¾åˆ°å·¥ä½œï¼Ÿ")])]),s._v(" "),t("p",[s._v("æœ€è¿‘ç»å¸¸æœ‰å°ä¼™ä¼´é—®æˆ‘ï¼Œä»¥ä¸ºæˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œå­¦å¤šå°‘å¤Ÿï¼Œå¥½åƒæ›´å¤šçš„æ˜¯çœ‹ä½ çš„é‡å¿ƒæœ‰å¤šå¤§ã€‚å¦‚æœä½ åªæ˜¯æƒ³æ‰¾ä¸ª10kä»¥å†…çš„äºŒçº¿åŸå¸‚çš„å·¥ä½œï¼Œé‚£è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚ä¹Ÿä¸éœ€è¦å­¦æ•°æ®ç»“æ„ã€ä¹Ÿä¸éœ€è¦ä¼šç®—æ³•ã€ä¹Ÿéœ€è¦æ‡‚æºç ã€æ›´ä¸è¦æœ‰å¤šå°‘é¡¹ç›®ç»éªŒã€‚")]),s._v(" "),t("p",[s._v("ä½†åä¹‹æˆ‘é‡åˆ°ä¸€ä¸ªå›½å†…å¤§å­¦TOP2æ¯•ä¸šçš„å¨ƒï¼Œè¿™è´§å°±æ˜¯Offeræ”¶å‰²æœºï¼šè…¾è®¯ã€é˜¿é‡Œã€å­—èŠ‚è¿˜æœ‰å›½å¤–æ–°åŠ å¡çš„å·¥ä½œæœºä¼šç­‰ç­‰ï¼Œè–ªèµ„å¾…é‡ä¹Ÿæ˜¯è´¼é«˜ï¼Œå¯èƒ½è¶…è¿‡ä½ å¯¹ç™½èœä»·çš„è®¤çŸ¥ã€‚"),t("em",[s._v("ä¸Šå­¦æ— ç”¨ã€å­¦ä¹ æ— ç”¨ï¼Œçº¯å±æ‰¯æ·¡ï¼")])]),s._v(" "),t("p",[s._v("ä½ èƒ½åœ¨è¿™æ¡è·¯ä¸Šèƒ½ä»˜å‡ºçš„è¶Šå¤šï¼Œèƒ½åŠªåŠ›çš„è¶Šæ—©ï¼Œæ”¶è·å°±ä¼šè¶Šå¤§ï¼")]),s._v(" "),t("h2",{attrs:{id:"äºŒã€é¢è¯•é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€é¢è¯•é¢˜"}},[s._v("#")]),s._v(" äºŒã€é¢è¯•é¢˜")]),s._v(" "),t("p",[t("code",[s._v("è°¢é£æœºï¼Œå°è®°")]),s._v("ï¼Œåˆšå»å†¬å·´æ‹‰æ³¡å®Œè„šæ”¾æ¾çš„é£æœºï¼Œå› ä¸ºè€å…‹è¢œå­ä¸¢äº†ï¼Œéª‚éª‚å’§å’§çš„èµ´çº¦é¢è¯•å®˜ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šå’‹äº†ï¼Œé£æœºï¼Œæ€ä¹ˆçœ‹ä¸Šå»ä¸é«˜å…´ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šæ²¡äº‹ï¼Œæ²¡äº‹ï¼Œæˆ‘å¿ƒæ€æˆ‘å­¦çš„ synchronized å‘¢ï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šé‚£æ­£å¥½ï¼Œé£æœºä½ ä¼šé”å—ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå•Šã€‚ã€‚ã€‚æˆ‘æ²¡å»ä¼šæ‰€å‘€ï¼ï¼ï¼"),t("em",[s._v("ä½ å’‹çŸ¥é“")])]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šæˆ‘è¯´ Java é”ï¼Œä½ æƒ³å•¥å‘¢ï¼ä½ äº†è§£å…¬å¹³é”å—ï¼ŒçŸ¥é“æ€ä¹ˆå®ç°çš„å—ï¼Œç»™æˆ‘è¯´è¯´ï¼")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå…¬å¹³é”ï¼ï¼Ÿå—¯ï¼Œæ˜¯ä¸ ReentrantLock ä¸­ç”¨åˆ°äº†ï¼Œæˆ‘æ€ä¹ˆæ„Ÿè§‰ä¼¼ä¹æœ‰å°è±¡ï¼Œä½†æ˜¯ä¸è®°å¾—äº†ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šå“ï¼Œå›å®¶æœæœ CLH å§ï¼")]),s._v(" "),t("h2",{attrs:{id:"ä¸‰ã€reentrantlock-å’Œ-å…¬å¹³é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€reentrantlock-å’Œ-å…¬å¹³é”"}},[s._v("#")]),s._v(" ä¸‰ã€ReentrantLock å’Œ å…¬å¹³é”")]),s._v(" "),t("h3",{attrs:{id:"_1-reentrantlock-ä»‹ç»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-reentrantlock-ä»‹ç»"}},[s._v("#")]),s._v(" 1. ReentrantLock ä»‹ç»")]),s._v(" "),t("p",[s._v("é‰´äºä¸Šä¸€ç¯‡å°å‚…å“¥å·²ç»åŸºäºï¼ŒHotSpotè™šæ‹Ÿæœºæºç åˆ†æ  "),t("a",{attrs:{href:"https://bugstack.cn/interview/2020/10/28/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC15%E7%AF%87-%E7%A0%81%E5%86%9C%E4%BC%9A%E9%94%81-synchronized-%E8%A7%A3%E6%AF%92-%E5%89%96%E6%9E%90%E6%BA%90%E7%A0%81%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("synchronized"),t("OutboundLink")],1),s._v("  å®ç°å’Œç›¸åº”æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæœ¬æ¥æƒ³åœ¨æœ¬ç« ç›´æ¥ä»‹ç»ä¸‹ ReentrantLockã€‚ä½†å› ä¸º ReentrantLock çŸ¥è¯†ç‚¹è¾ƒå¤šï¼Œå› æ­¤ä¼šåˆ†å‡ ç¯‡åˆ†åˆ«è®²è§£ï¼Œçªå‡ºæ¯ä¸€ç¯‡é‡ç‚¹ï¼Œé¿å…çŒªå…«æˆ’åæ£ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ä»‹ç»")]),s._v("ï¼šReentrantLock æ˜¯ä¸€ä¸ªå¯é‡å…¥ä¸”ç‹¬å å¼é”ï¼Œå…·æœ‰ä¸ synchronized ç›‘è§†å™¨(monitor enterã€monitor exit)é”åŸºæœ¬ç›¸åŒçš„è¡Œä¸ºå’Œè¯­æ„ã€‚ä½†ä¸ synchronized ç›¸æ¯”ï¼Œå®ƒæ›´åŠ çµæ´»ã€å¼ºå¤§ã€å¢åŠ äº†è½®è¯¢ã€è¶…æ—¶ã€ä¸­æ–­ç­‰é«˜çº§åŠŸèƒ½ä»¥åŠå¯ä»¥åˆ›å»ºå…¬å¹³å’Œéå…¬å¹³é”ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_2-reentrantlock-çŸ¥è¯†é“¾æ¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-reentrantlock-çŸ¥è¯†é“¾æ¡"}},[s._v("#")]),s._v(" 2. ReentrantLock çŸ¥è¯†é“¾æ¡")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 16-1 ReentrantLock é”çŸ¥è¯†é“¾æ¡","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-16-01.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("ReentrantLock æ˜¯åŸºäº Lock å®ç°çš„å¯é‡å…¥é”ï¼Œæ‰€æœ‰çš„ Lock éƒ½æ˜¯åŸºäº AQS å®ç°çš„ï¼ŒAQS å’Œ Condition å„è‡ªç»´æŠ¤ä¸åŒçš„å¯¹è±¡ï¼Œåœ¨ä½¿ç”¨ Lock å’Œ Condition æ—¶ï¼Œå…¶å®å°±æ˜¯ä¸¤ä¸ªé˜Ÿåˆ—çš„äº’ç›¸ç§»åŠ¨ã€‚å®ƒæ‰€æä¾›çš„å…±äº«é”ã€äº’æ–¥é”éƒ½æ˜¯åŸºäºå¯¹ state çš„æ“ä½œã€‚è€Œå®ƒçš„å¯é‡å…¥æ˜¯å› ä¸ºå®ç°äº†åŒæ­¥å™¨ Syncï¼Œåœ¨ Sync çš„ä¸¤ä¸ªå®ç°ç±»ä¸­ï¼ŒåŒ…æ‹¬äº†å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚")]),s._v(" "),t("p",[s._v("è¿™ä¸ªå…¬å¹³é”çš„å…·ä½“å®ç°ï¼Œå°±æ˜¯æˆ‘ä»¬æœ¬ç« èŠ‚è¦ä»‹ç»çš„é‡ç‚¹ï¼Œäº†è§£ä»€ä¹ˆæ˜¯å…¬å¹³é”ã€å…¬å¹³é”çš„å…·ä½“å®ç°ã€‚"),t("em",[s._v("å­¦ä¹ å®ŒåŸºç¡€çš„çŸ¥è¯†å¯ä»¥æ›´å¥½çš„ç†è§£ ReentrantLock")])]),s._v(" "),t("h3",{attrs:{id:"_3-reentrantlock-å…¬å¹³é”ä»£ç "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-reentrantlock-å…¬å¹³é”ä»£ç "}},[s._v("#")]),s._v(" 3. ReentrantLock å…¬å¹³é”ä»£ç ")]),s._v(" "),t("h4",{attrs:{id:"_3-1-åˆå§‹åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-åˆå§‹åŒ–"}},[s._v("#")]),s._v(" 3.1 åˆå§‹åŒ–")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// trueï¼šå…¬å¹³é”")]),s._v("\nlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// todo")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("åˆå§‹åŒ–æ„é€ å‡½æ•°å…¥å‚ï¼Œé€‰æ‹©æ˜¯å¦ä¸ºåˆå§‹åŒ–å…¬å¹³é”ã€‚")]),s._v(" "),t("li",[s._v("å…¶å®ä¸€èˆ¬æƒ…å†µä¸‹å¹¶ä¸éœ€è¦å…¬å¹³é”ï¼Œé™¤éä½ çš„åœºæ™¯ä¸­éœ€è¦ä¿è¯é¡ºåºæ€§ã€‚")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ ReentrantLock åˆ‡è®°éœ€è¦åœ¨ finally ä¸­å…³é—­ï¼Œ"),t("code",[s._v("lock.unlock()")]),s._v("ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_3-2-å…¬å¹³é”ã€éå…¬å¹³é”-é€‰æ‹©"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-å…¬å¹³é”ã€éå…¬å¹³é”-é€‰æ‹©"}},[s._v("#")]),s._v(" 3.2 å…¬å¹³é”ã€éå…¬å¹³é”ï¼Œé€‰æ‹©")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" fair"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sync "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fair "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NonfairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("æ„é€ å‡½æ•°ä¸­é€‰æ‹©å…¬å¹³é”ï¼ˆFairSyncï¼‰ã€éå…¬å¹³é”ï¼ˆNonfairSyncï¼‰ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_3-3-hasqueuedpredecessors"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-hasqueuedpredecessors"}},[s._v("#")]),s._v(" 3.3 hasQueuedPredecessors")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FairSync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasQueuedPredecessors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setExclusiveOwnerThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œä¸»è¦æ˜¯åœ¨æ–¹æ³• "),t("code",[s._v("tryAcquire")]),s._v(" ä¸­ï¼Œæ˜¯å¦æœ‰ "),t("code",[s._v("!hasQueuedPredecessors()")]),s._v(" åˆ¤æ–­ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_3-4-é˜Ÿåˆ—é¦–ä½åˆ¤æ–­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-é˜Ÿåˆ—é¦–ä½åˆ¤æ–­"}},[s._v("#")]),s._v(" 3.4 é˜Ÿåˆ—é¦–ä½åˆ¤æ–­")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasQueuedPredecessors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Read fields in reverse initialization order")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" h "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" head"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" h "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("åœ¨è¿™ä¸ªåˆ¤æ–­ä¸­ä¸»è¦å°±æ˜¯çœ‹å½“å‰çº¿ç¨‹æ˜¯ä¸æ˜¯åŒæ­¥é˜Ÿåˆ—çš„é¦–ä½ï¼Œæ˜¯ï¼štrueã€å¦ï¼šfalse")]),s._v(" "),t("li",[s._v("è¿™éƒ¨åˆ†å°±æ¶‰åŠåˆ°äº†å…¬å¹³é”çš„å®ç°ï¼ŒCLHï¼ˆCraigï¼ŒLandin andHagerstenï¼‰ã€‚"),t("em",[s._v("ä¸‰ä¸ªä½œè€…çš„é¦–å­—æ¯ç»„åˆ")])])]),s._v(" "),t("h2",{attrs:{id:"å››ã€ä»€ä¹ˆæ˜¯å…¬å¹³é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€ä»€ä¹ˆæ˜¯å…¬å¹³é”"}},[s._v("#")]),s._v(" å››ã€ä»€ä¹ˆæ˜¯å…¬å¹³é”")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 16-2 å…¬å…±å•æ‰€æ’é˜Ÿå…¥å‘","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-16-02.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("å…¬å¹³é”å°±åƒæ˜¯é©¬è·¯è¾¹ä¸Šçš„å«ç”Ÿé—´ï¼Œä¸Šå•æ‰€éœ€è¦æ’é˜Ÿã€‚å½“ç„¶å¦‚æœæœ‰äººä¸æ’é˜Ÿï¼Œé‚£ä¹ˆå°±æ˜¯éå…¬å¹³é”äº†ï¼Œæ¯”å¦‚é¢†å¯¼è¦å…ˆä¸Šã€‚")]),s._v(" "),t("p",[s._v("CLH æ˜¯ä¸€ç§åŸºäºå•å‘é“¾è¡¨çš„é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ã€‚AQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰ï¼ŒAQSæ˜¯é€šè¿‡å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ã€‚")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ›´å¥½çš„å­¦ä¹ ç†è§£ CLH çš„åŸç†ï¼Œå°±éœ€è¦æœ‰å®è·µçš„ä»£ç ã€‚æ¥ä¸‹æ¥ä¸€ CLH ä¸ºæ ¸å¿ƒåˆ†åˆ«ä»‹ç»4ç§å…¬å¹³é”çš„å®ç°ï¼Œä»è€ŒæŒæ¡æœ€åŸºæœ¬çš„æŠ€æœ¯æ ˆçŸ¥è¯†ã€‚")]),s._v(" "),t("h2",{attrs:{id:"äº”ã€å…¬å¹³é”å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€å…¬å¹³é”å®ç°"}},[s._v("#")]),s._v(" äº”ã€å…¬å¹³é”å®ç°")]),s._v(" "),t("h3",{attrs:{id:"_1-clh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-clh"}},[s._v("#")]),s._v(" 1. CLH")]),s._v(" "),t("h4",{attrs:{id:"_1-1-çœ‹å›¾è¯´è¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-çœ‹å›¾è¯´è¯"}},[s._v("#")]),s._v(" 1.1 çœ‹å›¾è¯´è¯")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 16-3 CLH å®ç°è¿‡ç¨‹åŸç†å›¾","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-16-03.png",loading:"lazy"}})]),s._v(" "),t("h4",{attrs:{id:"_1-2-ä»£ç å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-ä»£ç å®ç°"}},[s._v("#")]),s._v(" 1.2 ä»£ç å®ç°")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CLHLock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CLHLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" prev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CLHLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CLHLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" tail "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CLHLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" locked"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CLHLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withInitial")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withInitial")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CLHLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Node")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" pred_node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pred_node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è‡ªæ—‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pred_node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("h4",{attrs:{id:"_1-3-ä»£ç è®²è§£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ä»£ç è®²è§£"}},[s._v("#")]),s._v(" 1.3 ä»£ç è®²è§£")]),s._v(" "),t("p",[s._v("CLHï¼ˆCraigï¼ŒLandin and Hagerstenï¼‰ï¼Œæ˜¯ä¸€ç§åŸºäºé“¾è¡¨çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ã€‚")]),s._v(" "),t("p",[s._v("åœ¨è¿™æ®µä»£ç çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œç›¸å½“äºæ˜¯è™šæ‹Ÿå‡ºæ¥ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œç”± AtomicReference çš„æ–¹æ³• getAndSet è¿›è¡Œè¡”æ¥ã€‚"),t("em",[s._v("getAndSet è·å–å½“å‰å…ƒç´ ï¼Œè®¾ç½®æ–°çš„å…ƒç´ ")])]),s._v(" "),t("p",[t("strong",[s._v("lock()")])]),s._v(" "),t("ul",[t("li",[s._v("é€šè¿‡ "),t("code",[s._v("this.node.get()")]),s._v(" è·å–å½“å‰èŠ‚ç‚¹ï¼Œå¹¶è®¾ç½® locked ä¸º trueã€‚")]),s._v(" "),t("li",[s._v("æ¥ç€è°ƒç”¨ "),t("code",[s._v("this.tail.getAndSet(node)")]),s._v("ï¼Œè·å–å½“å‰å°¾éƒ¨èŠ‚ç‚¹ pred_nodeï¼ŒåŒæ—¶æŠŠæ–°åŠ å…¥çš„èŠ‚ç‚¹è®¾ç½®æˆå°¾éƒ¨èŠ‚ç‚¹ã€‚")]),s._v(" "),t("li",[s._v("ä¹‹åå°±æ˜¯æŠŠ this.prev è®¾ç½®ä¸ºä¹‹å‰çš„å°¾éƒ¨èŠ‚ç‚¹ï¼Œä¹Ÿå°±ç›¸å½“äºé“¾è·¯çš„æŒ‡å‘ã€‚")]),s._v(" "),t("li",[s._v("æœ€åå°±æ˜¯è‡ªæ—‹ "),t("code",[s._v("while (pred_node.locked)")]),s._v("ï¼Œç›´è‡³ç¨‹åºé‡Šæ”¾ã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("unlock()")])]),s._v(" "),t("ul",[t("li",[s._v("é‡Šæ”¾é”çš„è¿‡ç¨‹å°±æ˜¯æ‹†é“¾ï¼ŒæŠŠé‡Šæ”¾é”çš„èŠ‚ç‚¹è®¾ç½®ä¸ºfalse "),t("code",[s._v("node.locked = false")]),s._v("ã€‚")]),s._v(" "),t("li",[s._v("ä¹‹åæœ€é‡è¦çš„æ˜¯æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·å°±ç›¸å½“äºæŠŠè‡ªå·±çš„èŠ‚ç‚¹æ‹†ä¸‹æ¥äº†ï¼Œç­‰ç€åƒåœ¾å›æ”¶ã€‚")])]),s._v(" "),t("p",[t("code",[s._v("CLH")]),s._v("é˜Ÿåˆ—é”çš„ä¼˜ç‚¹æ˜¯ç©ºé—´å¤æ‚åº¦ä½ï¼Œåœ¨SMPï¼ˆSymmetric Multi-Processorï¼‰å¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„ï¼ˆä¸€å°è®¡ç®—æœºç”±å¤šä¸ªCPUç»„æˆï¼Œå¹¶å…±äº«å†…å­˜å’Œå…¶ä»–èµ„æºï¼Œæ‰€æœ‰çš„CPUéƒ½å¯ä»¥å¹³ç­‰åœ°è®¿é—®å†…å­˜ã€I/Oå’Œå¤–éƒ¨ä¸­æ–­ï¼‰æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚ä½†åœ¨ NUMA(Non-Uniform Memory Access) ä¸‹æ•ˆæœå°±ä¸å¤ªå¥½äº†ï¼Œè¿™éƒ¨åˆ†çŸ¥è¯†å¯ä»¥è‡ªè¡Œæ‰©å±•ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_2-mcslock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-mcslock"}},[s._v("#")]),s._v(" 2. MCSLock")]),s._v(" "),t("h4",{attrs:{id:"_2-1-ä»£ç å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-ä»£ç å®ç°"}},[s._v("#")]),s._v(" 2.1 ä»£ç å®ç°")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MCSLock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MCSLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" tail "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MCSLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MCSLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withInitial")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" preNode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" preNode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        preNode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("h4",{attrs:{id:"_2-1-ä»£ç è®²è§£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-ä»£ç è®²è§£"}},[s._v("#")]),s._v(" 2.1 ä»£ç è®²è§£")]),s._v(" "),t("p",[s._v("MCS æ¥è‡ªäºå‘æ˜äººåå­—çš„é¦–å­—æ¯ï¼š John Mellor-Crummeyå’ŒMichael Scottã€‚")]),s._v(" "),t("p",[s._v("å®ƒä¹Ÿæ˜¯ä¸€ç§åŸºäºé“¾è¡¨çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ï¼Œä½†ä¸ CLH ä¸åŒã€‚å®ƒæ˜¯çœŸçš„æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ nextï¼Œæ·»åŠ è¿™ä¸ªçœŸå®èŠ‚ç‚¹åï¼Œå®ƒå°±å¯ä»¥åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œè€Œ CLH æ˜¯å‰é©±èŠ‚ç‚¹çš„å±æ€§ä¸Šè‡ªæ—‹ã€‚")]),s._v(" "),t("p",[s._v("å› ä¸ºè‡ªæ—‹èŠ‚ç‚¹çš„ä¸åŒï¼Œå¯¼è‡´ CLH æ›´é€‚åˆäº SMP æ¶æ„ã€MCS å¯ä»¥é€‚åˆ NUMA éä¸€è‡´å­˜å‚¨è®¿é—®æ¶æ„ã€‚ä½ å¯ä»¥æƒ³è±¡æˆ CLH æ›´éœ€è¦çº¿ç¨‹æ•°æ®åœ¨åŒä¸€å—å†…å­˜ä¸Šæ•ˆæœæ‰æ›´å¥½ï¼ŒMCS å› ä¸ºæ˜¯åœ¨æœ¬åº—å˜é‡è‡ªé€‰ï¼Œæ‰€ä»¥æ— è®ºæ•°æ®æ˜¯å¦åˆ†æ•£åœ¨ä¸åŒçš„CPUæ¨¡å—éƒ½æ²¡æœ‰å½±å“ã€‚")]),s._v(" "),t("p",[s._v("ä»£ç å®ç°ä¸Šä¸ CLH æ²¡æœ‰å¤ªå¤šå·®å¼‚ï¼Œè¿™é‡Œå°±ä¸åœ¨å™è¿°äº†ï¼Œå¯ä»¥çœ‹ä»£ç å­¦ä¹ ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_3-ticketlock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ticketlock"}},[s._v("#")]),s._v(" 3. TicketLock")]),s._v(" "),t("h4",{attrs:{id:"_3-1-çœ‹å›¾è¯´è¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-çœ‹å›¾è¯´è¯"}},[s._v("#")]),s._v(" 3.1 çœ‹å›¾è¯´è¯")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 16-4 é“¶è¡Œæ’é˜Ÿå«å·å›¾","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-16-04.png",loading:"lazy"}})]),s._v(" "),t("h4",{attrs:{id:"_3-2-ä»£ç å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-ä»£ç å®ç°"}},[s._v("#")]),s._v(" 3.2 ä»£ç å®ç°")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TicketLock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),s._v(" serviceCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),s._v(" ticketCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" owner "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        owner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ticketCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndIncrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("serviceCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" owner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        serviceCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("owner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" owner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        owner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h4",{attrs:{id:"_3-3-ä»£ç è®²è§£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-ä»£ç è®²è§£"}},[s._v("#")]),s._v(" 3.3 ä»£ç è®²è§£")]),s._v(" "),t("p",[s._v("TicketLock å°±åƒä½ å»é“¶è¡Œã€å‘·å“ºç»™ä½ çš„ä¸€ä¸ªæ’å·å¡ä¸€æ ·ï¼Œå«åˆ°ä½ å·ä½ æ‰èƒ½è¿›å»ã€‚å±äºä¸¥æ ¼çš„å…¬å¹³æ€§å®ç°ï¼Œä½†æ˜¯å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹å ç”¨çš„å¤„ç†å™¨éƒ½åœ¨è¯»å†™åŒä¸€ä¸ªå˜é‡ï¼Œæ¯æ¬¡è¯»å†™æ“ä½œéƒ½éœ€è¦è¿›è¡Œå¤šå¤„ç†é—´çš„ç¼“å­˜åŒæ­¥ï¼Œéå¸¸æ¶ˆè€—ç³»ç»Ÿæ€§èƒ½ã€‚")]),s._v(" "),t("p",[s._v("ä»£ç å®ç°ä¸Šä¹Ÿæ¯”è¾ƒç®€å•ï¼Œlock() ä¸­è®¾ç½®æ‹¥æœ‰è€…çš„å·ç‰Œï¼Œå¹¶è¿›å…¥è‡ªæ—‹æ¯”å¯¹ã€‚unlock() ä¸­ä½¿ç”¨ CAS è¿›è¡Œè§£é”æ“ä½œï¼Œå¹¶å¤„ç†ç§»é™¤ã€‚")]),s._v(" "),t("h2",{attrs:{id:"å…­ã€æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…­ã€æ€»ç»“"}},[s._v("#")]),s._v(" å…­ã€æ€»ç»“")]),s._v(" "),t("ul",[t("li",[s._v("ReentrantLock æ˜¯åŸºäº Lock å®ç°çš„å¯é‡å…¥é”ï¼Œå¯¹äºå…¬å¹³é” CLH çš„å®ç°ï¼Œåªæ˜¯è¿™éƒ¨åˆ†çŸ¥è¯†çš„å†°å±±ä¸€è§’ï¼Œä½†æœ‰è¿™ä¸€"),t("strong",[s._v("è„š")]),s._v("ï¼Œå°±å¯ä»¥å¾ˆå¥½çƒ­èº«ä¾¿äºåç»­çš„å­¦ä¹ ã€‚")]),s._v(" "),t("li",[s._v("ReentrantLock ä½¿ç”¨èµ·æ¥æ›´åŠ çµæ´»ï¼Œå¯æ“ä½œæ€§ä¹Ÿæ›´å¤§ï¼Œä½†ä¸€å®šè¦åœ¨ finally ä¸­é‡Šæ”¾é”ï¼Œç›®çš„æ˜¯ä¿è¯åœ¨è·å–é”ä¹‹åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¢«é‡Šæ”¾ã€‚åŒæ—¶ä¸è¦å°†è·å–é”çš„è¿‡ç¨‹å†™åœ¨ try é‡Œé¢ã€‚")]),s._v(" "),t("li",[s._v("å…¬å¹³é”çš„å®ç°ä¾æ®ä¸åŒåœºæ™¯å’ŒSMPã€NUMAçš„ä½¿ç”¨ï¼Œä¼šæœ‰ä¸åŒçš„ä¼˜åŠ£æ•ˆæœã€‚åœ¨å®é™…çš„ä½¿ç”¨ä¸­ä¸€èˆ¬é»˜è®¤ä¼šé€‰æ‹©éå…¬å¹³é”ï¼Œå³ä½¿æ˜¯è‡ªæ—‹ä¹Ÿæ˜¯è€—è´¹æ€§èƒ½çš„ï¼Œä¸€èˆ¬ä¼šç”¨åœ¨è¾ƒå°‘ç­‰å¾…çš„çº¿ç¨‹ä¸­ï¼Œé¿å…è‡ªæ—‹æ—¶è¿‡é•¿ã€‚")])])])}),[],!1,null,null,null);t.default=e.exports}}]);