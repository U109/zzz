(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{339:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"é¢ç»æ‰‹å†Œ-Â·-ç¬¬18ç¯‡ã€Šaqs-å…±äº«é”-semaphoreã€countdownlatch-å¬è¯´æ•°æ®åº“è¿æ¥æ± å¯ä»¥ç”¨åˆ°-ã€‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¢ç»æ‰‹å†Œ-Â·-ç¬¬18ç¯‡ã€Šaqs-å…±äº«é”-semaphoreã€countdownlatch-å¬è¯´æ•°æ®åº“è¿æ¥æ± å¯ä»¥ç”¨åˆ°-ã€‹"}},[s._v("#")]),s._v(" é¢ç»æ‰‹å†Œ Â· ç¬¬18ç¯‡ã€ŠAQS å…±äº«é”ï¼ŒSemaphoreã€CountDownLatchï¼Œå¬è¯´æ•°æ®åº“è¿æ¥æ± å¯ä»¥ç”¨åˆ°ï¼ã€‹")]),s._v(" "),t("p",[s._v("ä½œè€…ï¼šå°å‚…å“¥\n"),t("br"),s._v("åšå®¢ï¼š"),t("a",{attrs:{href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://bugstack.cn"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")])]),s._v(" "),t("h2",{attrs:{id:"ä¸€ã€å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€å‰è¨€"}},[s._v("#")]),s._v(" ä¸€ã€å‰è¨€")]),s._v(" "),t("p",[t("code",[s._v("å­¦Javaæ€ä¹ˆèƒ½ï¼Œçªé£çŒ›è¿›çš„æˆé•¿ï¼Ÿ")])]),s._v(" "),t("p",[s._v("æ˜¯ä¸æ˜¯ä½ çœ‹è§è¿‡çš„çªé£çŒ›è¿›éƒ½æ˜¯åˆ«äººï¼Œä½†è‡ªå·±å´å¾ˆéš¾ï¼")]),s._v(" "),t("p",[s._v("å…¶å®å¹¶æ²¡æœ‰ä¸€å¤©çš„çªé£çŒ›è¿›ï¼Œä¹Ÿæ²¡æœ‰ä¸€å£åƒå‡ºæ¥çš„èƒ–å­ã€‚æœ‰å¾—æ›´å¤šçš„æ—¶å€™æ—¥ç§¯æœˆç´¯ã€ä¸æ–­æ²‰æ·€ï¼Œæœ€åæ‰èƒ½çˆ†å‘ã€ç ´å±€ï¼")]),s._v(" "),t("p",[s._v("ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœä½ å¤§å­¦æ¯•ä¸šæ—¶å€™å·²ç»å†™äº†40ä¸‡è¡Œä»£ç ï¼Œè¿˜æ‰¾ä¸åˆ°å·¥ä½œå—ï¼Ÿä½†40ä¸‡è¡Œå¹³å‡åˆ°æ¯å¤©å¹¶ä¸ä¼šå¾ˆå¤šï¼Œé‡è¦çš„æ˜¯æŒä¹‹ä»¥æ’çš„åšæŒã€‚")]),s._v(" "),t("h2",{attrs:{id:"äºŒã€é¢è¯•é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€é¢è¯•é¢˜"}},[s._v("#")]),s._v(" äºŒã€é¢è¯•é¢˜")]),s._v(" "),t("p",[t("code",[s._v("è°¢é£æœºï¼Œå°è®°ï¼")]),s._v(" ä¸œé£å¹ã€æˆ˜é¼“æ“‚ï¼Œä¸åŠ ç­ã€è°æ€•è°ï¼å“ˆå“ˆå“ˆï¼Œæ‰¾æˆ‘å¤§å“¥å»ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå–‚ï¼Œå¤§å“¥ã€‚æˆ‘å¥³å‹é¢è¯•å¡ä½äº†ï¼Œå¼ºäºº"),t("code",[s._v("é”")]),s._v("éš¾ï¼Œé”æˆ‘ä¹Ÿä¸ä¼šï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šä½ ä¸åº”è¯¥ä¸ä¼šå‘€ï¼Œé—®ä½ ä¸€ä¸ªï¼ŒåŸºäº AQS å®ç°çš„é”éƒ½æœ‰å“ªäº›ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå—¯ï¼Œæœ‰ ReentrantLock...")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šè¿˜æœ‰å‘¢ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå¥½åƒæƒ³ä¸èµ·æ¥äº†ï¼Œsyncä¹Ÿä¸æ˜¯ï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šå“ï¼Œå­¦ç‚¹æ¼ç‚¹ï¼Œä¸æ€è€ƒã€ä¸æ€»ç»“ã€ä¸è®°å½•ã€‚ä½ è¿™æ ·äººå®¶é¢è¯•ä½ å°±æ²¡æ³•èŠäº†ï¼Œæœ€èµ·ç ä½ è¦æœ‰ç‚¹æ·±åº¦ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå˜¿å˜¿ï¼Œè®°ä½äº†ã€‚æ¥æˆ‘å®¶åƒç«é”…å§ï¼Œç»†èŠã€‚")]),s._v(" "),t("h2",{attrs:{id:"ä¸‰ã€å…±äº«é”-å’Œ-aqs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€å…±äº«é”-å’Œ-aqs"}},[s._v("#")]),s._v(" ä¸‰ã€å…±äº«é” å’Œ AQS")]),s._v(" "),t("h3",{attrs:{id:"_1-åŸºäº-aqs-å®ç°çš„é”æœ‰å“ªäº›"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŸºäº-aqs-å®ç°çš„é”æœ‰å“ªäº›"}},[s._v("#")]),s._v(" 1. åŸºäº AQS å®ç°çš„é”æœ‰å“ªäº›ï¼Ÿ")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 18-1 åŸºäº AQS å®ç°çš„é”","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-18-1.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("AQSï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œæ˜¯ Java å¹¶å‘åŒ…ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç±»ï¼Œå¤§éƒ¨åˆ†é”çš„å®ç°ä¹Ÿæ˜¯åŸºäº AQS å®ç°çš„ï¼ŒåŒ…æ‹¬ï¼š")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ReentrantLock")]),s._v("ï¼Œå¯é‡å…¥é”ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬æœ€å¼€å§‹ä»‹ç»çš„é”ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„é”ã€‚é€šå¸¸ä¼šä¸ synchronized åšæ¯”è¾ƒä½¿ç”¨ã€‚")]),s._v(" "),t("li",[t("code",[s._v("ReentrantReadWriteLock")]),s._v("ï¼Œè¯»å†™é”ã€‚è¯»é”æ˜¯å…±äº«é”ã€å†™é”æ˜¯ç‹¬å é”ã€‚")]),s._v(" "),t("li",[t("code",[s._v("Semaphore")]),s._v("ï¼Œä¿¡å·é‡é”ã€‚ä¸»è¦ç”¨äºæ§åˆ¶æµé‡ï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“è¿æ¥æ± ç»™ä½ åˆ†é…10ä¸ªé“¾æ¥ï¼Œé‚£ä¹ˆè®©ä½ æ¥ä¸€ä¸ªè¿ä¸€ä¸ªï¼Œè¿åˆ°10ä¸ªè¿˜æ²¡æœ‰äººé‡Šæ”¾ï¼Œé‚£ä½ å°±ç­‰ç­‰ã€‚")]),s._v(" "),t("li",[t("code",[s._v("CountDownLatch")]),s._v("ï¼Œé—­é”ã€‚Latch é—¨é—©çš„æ„æ€ï¼Œæ¯”å¦‚ï¼šè¯´å››ä¸ªäººä¸€ä¸ªæ¼‚æµè‰‡ï¼Œåæ»¡äº†å°±æ¨ä¸‹æ°´ã€‚")])]),s._v(" "),t("p",[s._v("è¿™ä¸€ç« èŠ‚æˆ‘ä»¬ä¸»è¦æ¥ä»‹ç» Semaphore ï¼Œä¿¡å·é‡é”çš„å®ç°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä»‹ç»ä¸€ä¸ªå…³äºå…±äº«é”çš„ä½¿ç”¨å’Œæºç åˆ†æã€‚")]),s._v(" "),t("h3",{attrs:{id:"_2-semaphore-å…±äº«é”ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-semaphore-å…±äº«é”ä½¿ç”¨"}},[s._v("#")]),s._v(" 2. Semaphore å…±äº«é”ä½¿ç”¨")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),s._v(" semaphore "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ å‡½æ•°å…¥å‚ï¼Œpermitsï¼šä¿¡å·é‡ã€fairï¼šå…¬å¹³é”/éå…¬å¹³é”")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            semaphore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"è¹²å‘"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" ignore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            semaphore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"è¹²å‘ç¼–å·ï¼š"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªåœ¨é«˜é€ŸæœåŠ¡åŒºï¼Œå•æ‰€æ’é˜Ÿè¹²å‘çš„åœºæ™¯ã€‚ç”±äºå‘ä½æœ‰é™ï¼Œä¸ºäº†é¿å…é€ æˆæ‹¥æŒ¤å’Œè¸©è¸ï¼Œä¿å®‰äººå‘˜åœ¨é—¨å£æ‹¦ç€ï¼Œæ„Ÿè§‰å·®ä¸å¤šï¼Œä¸€æ¬¡é‡Šæ”¾ä¸¤ä¸ªè¿›å»ï¼Œä¸€ç›´åˆ°éƒ½é‡Šæ”¾ã€‚"),t("em",[s._v("ä½ ä¹Ÿå¯ä»¥æƒ³æˆæ—©ä¸Šååœ°é“ä¸Šç­ï¼Œæˆ–è€…æ—ºå­£å»å…¬å›­ï¼Œéƒ½æ˜¯ä¸€æ‰¹ä¸€æ‰¹çš„æ”¾è¡Œ")])]),s._v(" "),t("p",[t("strong",[s._v("æµ‹è¯•ç»“æœ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("è¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("è¹²å‘\nè¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("è¹²å‘\n\nè¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("è¹²å‘\nè¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("è¹²å‘\n\nè¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("è¹²å‘\nè¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("è¹²å‘\n\nè¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("è¹²å‘\nè¹²å‘ç¼–å·ï¼š"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("è¹²å‘\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Process")]),s._v(" finished "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("exit")]),s._v(" code "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("Semaphore çš„æ„é€ å‡½æ•°å¯ä»¥ä¼ é€’æ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œæœ€ç»ˆçš„æµ‹è¯•ç»“æœä¹Ÿä¸åŒï¼Œå¯ä»¥è‡ªè¡Œå°è¯•ã€‚")]),s._v(" "),t("li",[s._v("æµ‹è¯•è¿è¡Œæ—¶ï¼Œä¼šå…ˆè¾“å‡º"),t("code",[s._v("0å‘ã€1å‘")]),s._v("ï¼Œ"),t("code",[s._v("ä¹‹å2å‘ã€3å‘")]),s._v("...ï¼Œæ¯æ¬¡éƒ½æ˜¯è¿™æ ·ä¸¤ä¸ªï¼Œä¸¤ä¸ªçš„é‡Šæ”¾ã€‚è¿™å°±æ˜¯ Semaphore ä¿¡å·é‡é”çš„ä½œç”¨ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_3-semaphore-æºç åˆ†æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-semaphore-æºç åˆ†æ"}},[s._v("#")]),s._v(" 3. Semaphore æºç åˆ†æ")]),s._v(" "),t("h4",{attrs:{id:"_3-1-æ„é€ å‡½æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-æ„é€ å‡½æ•°"}},[s._v("#")]),s._v(" 3.1 æ„é€ å‡½æ•°")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sync "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NonfairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" fair"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sync "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fair "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NonfairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("em",[s._v("permitsï¼šn. è®¸å¯è¯ï¼Œç‰¹è®¸è¯(å°¤æŒ‡é™æœŸçš„)")])]),s._v(" "),t("p",[s._v("é»˜è®¤æƒ…å†µä¸‹åªéœ€è¦ä¼ å…¥ permits è®¸å¯è¯æ•°é‡å³å¯ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡å…è®¸æ”¾è¡Œå‡ ä¸ªçº¿ç¨‹ã€‚æ„é€ å‡½æ•°ä¼šåˆ›å»ºéå…¬å¹³é”ã€‚å¦‚æœä½ éœ€è¦ä½¿ç”¨ Semaphore å…±äº«é”ä¸­çš„å…¬å¹³é”ï¼Œé‚£ä¹ˆå¯ä»¥ä¼ å…¥ç¬¬äºŒä¸ªæ„é€ å‡½æ•°çš„å‚æ•° fair = false/trueã€‚trueï¼šFairSyncï¼Œå…¬å¹³é”ã€‚"),t("em",[s._v("åœ¨æˆ‘ä»¬å‰é¢çš„ç« èŠ‚å·²ç»ä»‹ç»äº†å…¬å¹³é”ç›¸å…³å†…å®¹å’Œå®ç°ï¼Œä»¥åŠCLHã€MCS")]),s._v(" "),t("a",{attrs:{href:"https://bugstack.cn/interview/2020/11/04/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC16%E7%AF%87-%E7%A0%81%E5%86%9C%E4%BC%9A%E9%94%81-ReentrantLock%E4%B9%8B%E5%85%AC%E5%B9%B3%E9%94%81%E8%AE%B2%E8%A7%A3%E5%92%8C%E5%AE%9E%E7%8E%B0.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ã€Šå…¬å¹³é”ä»‹ç»ã€‹"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("åˆå§‹"),t("code",[s._v("è®¸å¯è¯")]),s._v("æ•°é‡")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FairSync")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NonfairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" newState"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" newState"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ— è®ºæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œéƒ½ä¼šè®¾ç½® AQS ä¸­ state æ•°é‡å€¼ã€‚è¿™ä¸ªå€¼ä¹Ÿå°±æ˜¯ä¸ºäº†ä¸‹æ–‡ä¸­å¯ä»¥è·å–çš„ä¿¡å·é‡æ‰£å‡å’Œå¢åŠ çš„å€¼ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_3-2-acquire-è·å–ä¿¡å·é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-acquire-è·å–ä¿¡å·é‡"}},[s._v("#")]),s._v(" 3.2 acquire è·å–ä¿¡å·é‡")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("æ–¹æ³•")]),s._v(" "),t("th",[s._v("æè¿°")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("semaphore.acquire()")])]),s._v(" "),t("td",[s._v("ä¸€æ¬¡è·å–ä¸€ä¸ªä¿¡å·é‡ï¼Œå“åº”ä¸­æ–­")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("semaphore.acquire(2)")])]),s._v(" "),t("td",[s._v("ä¸€æ¬¡è·å–nä¸ªä¿¡å·é‡ï¼Œå“åº”ä¸­æ–­ï¼ˆä¸€æ¬¡å 2ä¸ªå‘ï¼‰")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("semaphore.acquireUninterruptibly()")])]),s._v(" "),t("td",[s._v("ä¸€æ¬¡è·å–ä¸€ä¸ªä¿¡å·é‡ï¼Œä¸å“åº”ä¸­æ–­")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("semaphore.acquireUninterruptibly(2)")])]),s._v(" "),t("td",[s._v("ä¸€æ¬¡è·å–nä¸ªä¿¡å·é‡ï¼Œä¸å“åº”ä¸­æ–­")])])])]),s._v(" "),t("ul",[t("li",[s._v("å…¶å®è·å–ä¿¡å·é‡çš„è¿™å››ä¸ªæ–¹æ³•ï¼Œä¸»è¦å°±æ˜¯ï¼Œä¸€æ¬¡è·å–å‡ ä¸ªå’Œæ˜¯å¦å“åº”ä¸­æ–­çš„ç»„åˆã€‚")]),s._v(" "),t("li",[t("code",[s._v("semaphore.acquire()")]),s._v("ï¼Œæºç ä¸­å®é™…è°ƒç”¨çš„æ–¹æ³•æ˜¯ï¼Œ"),t("code",[s._v("sync.acquireSharedInterruptibly(1)")]),s._v("ã€‚ä¹Ÿå°±æ˜¯ç›¸åº”ä¸­æ–­ï¼Œä¸€æ¬¡åªå ä¸€ä¸ªå‘ã€‚")]),s._v(" "),t("li",[t("code",[s._v("semaphore.acquire(2)")]),s._v("ï¼ŒåŒç†è¿™ä¸ªå°±æ˜¯ä¸€æ¬¡è¦å ä¸¤ä¸ªåé¢ï¼Œä¹Ÿå°±æ˜¯è®¸å¯è¯ã€‚"),t("em",[s._v("ç”Ÿæ´»ä¸­çš„åœºæ™¯å°±æ˜¯æˆ‘ç»™æˆ‘æœ‹å‹æ’çš„å¯¹ï¼Œå¥¹æ¥äº†ï¼Œè¿›æ¥å§ã€‚")])])]),s._v(" "),t("h4",{attrs:{id:"_3-3-acquire-é‡Šæ”¾ä¿¡å·é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-acquire-é‡Šæ”¾ä¿¡å·é‡"}},[s._v("#")]),s._v(" 3.3 acquire é‡Šæ”¾ä¿¡å·é‡")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("æ–¹æ³•")]),s._v(" "),t("th",[s._v("æè¿°")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("semaphore.release()")])]),s._v(" "),t("td",[s._v("ä¸€æ¬¡é‡Šæ”¾ä¸€ä¸ªä¿¡å·é‡")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("semaphore.release(2)")])]),s._v(" "),t("td",[s._v("ä¸€æ¬¡è·å–nä¸ªä¿¡å·é‡")])])])]),s._v(" "),t("p",[s._v("æœ‰è·å–å°±å¾—æœ‰é‡Šæ”¾ï¼Œè·å–äº†å‡ ä¸ªä¿¡å·é‡å°±è¦é‡Šæ”¾å‡ ä¸ªä¿¡å·é‡ã€‚"),t("em",[s._v("å½“ç„¶ä½ å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œè·å–ä¿¡å·é‡ semaphore.acquire(2) ä¸¤ä¸ªï¼Œé‡Šæ”¾ä¿¡å·é‡ semaphore.release(1)ï¼Œçœ‹çœ‹è¿è¡Œæ•ˆæœ")])]),s._v(" "),t("h4",{attrs:{id:"_3-4-å…¬å¹³é”å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-å…¬å¹³é”å®ç°"}},[s._v("#")]),s._v(" 3.4 å…¬å¹³é”å®ç°")]),s._v(" "),t("p",[t("strong",[s._v("ä¿¡å·é‡è·å–è¿‡ç¨‹")]),s._v("ï¼Œä¸€ç›´åˆ°å…¬å¹³é”å®ç°ã€‚"),t("code",[s._v("semaphore.acquire")]),s._v(" -> "),t("code",[s._v("sync.acquireSharedInterruptibly(permits)")]),s._v(" -> "),t("code",[s._v("tryAcquireShared(arg)")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("semaphore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    sync"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquireSharedInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("permits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquireSharedInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doAcquireSharedInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("strong",[s._v("FairSync.tryAcquireShared")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasQueuedPredecessors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" available "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" remaining "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" available "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("remaining "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" remaining"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" remaining"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("hasQueuedPredecessors")]),s._v("ï¼Œå…¬å¹³é”çš„ä¸»è¦å®ç°é€»è¾‘éƒ½åœ¨äºè¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨ã€‚å®ƒçš„ç›®çš„å°±æ˜¯åˆ¤æ–­æœ‰çº¿ç¨‹æ’åœ¨è‡ªå·±å‰é¢æ²¡ï¼Œä»¥åŠæŠŠçº¿ç¨‹æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„é€»è¾‘å®ç°ã€‚"),t("em",[s._v("åœ¨å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡CLHç­‰å®ç°ï¼Œå¯ä»¥å¾€å‰ä¸€ç« èŠ‚é˜…è¯»")])]),s._v(" "),t("li",[t("code",[s._v("for (;;)")]),s._v("ï¼Œæ˜¯ä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼Œé€šè¿‡ CAS æ¥è®¾ç½® state åç§»é‡å¯¹åº”å€¼ã€‚è¿™æ ·å°±å¯ä»¥é¿å…å¤šçº¿ç¨‹ä¸‹ç«äº‰è·å–ä¿¡å·é‡å†²çªã€‚")]),s._v(" "),t("li",[t("code",[s._v("getState()")]),s._v("ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­å·²ç»åˆå§‹åŒ– state å€¼ï¼Œåœ¨è¿™é‡Œè·å–ä¿¡å·é‡æ—¶å°±æ˜¯ä½¿ç”¨ CAS ä¸æ–­çš„æ‰£å‡ã€‚")]),s._v(" "),t("li",[s._v("å¦å¤–éœ€è¦æ³¨æ„ï¼Œå…±äº«é”å’Œç‹¬å é”åœ¨è¿™é‡Œæ˜¯æœ‰åŒºåˆ«çš„ï¼Œç‹¬å é”ç›´æ¥è¿”å›true/falseï¼Œå…±äº«é”è¿”å›çš„æ˜¯intå€¼ã€‚\n"),t("ul",[t("li",[s._v("å¦‚æœè¯¥å€¼å°äº0ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–å…±äº«é”å¤±è´¥ã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœè¯¥å€¼å¤§äº0ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–å…±äº«é”æˆåŠŸï¼Œå¹¶ä¸”æ¥ä¸‹æ¥å…¶ä»–çº¿ç¨‹å°è¯•è·å–å…±äº«é”çš„è¡Œä¸ºå¾ˆå¯èƒ½æˆåŠŸã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœè¯¥å€¼ç­‰äº0ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–å…±äº«é”æˆåŠŸï¼Œä½†æ˜¯æ¥ä¸‹æ¥å…¶ä»–çº¿ç¨‹å°è¯•è·å–å…±äº«é”çš„è¡Œä¸ºä¼šå¤±è´¥ã€‚")])])])]),s._v(" "),t("h4",{attrs:{id:"_3-5-éå…¬å¹³é”å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-éå…¬å¹³é”å®ç°"}},[s._v("#")]),s._v(" 3.5 éå…¬å¹³é”å®ç°")]),s._v(" "),t("p",[t("strong",[s._v("NonfairSync.nonfairTryAcquireShared")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nonfairTryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nonfairTryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" available "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" remaining "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" available "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("remaining "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" remaining"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" remaining"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("æœ‰äº†å…¬å¹³é”çš„å®ç°ï¼Œéå…¬å¹³é”çš„ç†è§£å°±æ¯”è¾ƒç®€å•äº†ï¼Œåªæ˜¯æ‹¿å»äº† "),t("code",[s._v("if (hasQueuedPredecessors())")]),s._v(" çš„åˆ¤æ–­æ“ä½œã€‚")]),s._v(" "),t("li",[s._v("å…¶ä»–çš„é€»è¾‘å®ç°éƒ½å’Œå…¬å¹³é”ä¸€è‡´ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_3-6-è·å–ä¿¡å·é‡å¤±è´¥-åŠ å…¥åŒæ­¥ç­‰å¾…é˜Ÿåˆ—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-è·å–ä¿¡å·é‡å¤±è´¥-åŠ å…¥åŒæ­¥ç­‰å¾…é˜Ÿåˆ—"}},[s._v("#")]),s._v(" 3.6 è·å–ä¿¡å·é‡å¤±è´¥ï¼ŒåŠ å…¥åŒæ­¥ç­‰å¾…é˜Ÿåˆ—")]),s._v(" "),t("p",[s._v("åœ¨å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°æ­£å¸¸è·å–ä¿¡å·é‡çš„é€»è¾‘ã€‚é‚£ä¹ˆå¦‚æœæ­¤æ—¶ä¸èƒ½æ­£å¸¸è·å–ä¿¡å·é‡å‘¢ï¼Ÿå…¶å®è¿™éƒ¨åˆ†çº¿ç¨‹å°±éœ€è¦åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("doAcquireSharedInterruptibly")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquireSharedInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doAcquireSharedInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doAcquireSharedInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWaiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHARED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" failed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("predecessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" head"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHeadAndPropagate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// help GC")]),s._v("\n                    failed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldParkAfterFailedAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parkAndCheckInterrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("failed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cancelAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("ul",[t("li",[s._v("é¦–å…ˆ "),t("code",[s._v("doAcquireSharedInterruptibly")]),s._v(" æ–¹æ³•æ¥è‡ª AQS çš„å†…éƒ¨æ–¹æ³•ï¼Œä¸æˆ‘ä»¬åœ¨å­¦ä¹ ç«äº‰é”æ—¶æœ‰éƒ¨åˆ†çŸ¥è¯†ç‚¹ç›¸åŒï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å·®å¼‚ã€‚æ¯”å¦‚ï¼š"),t("code",[s._v("addWaiter(Node.SHARED)")]),s._v("ï¼Œ"),t("code",[s._v("tryAcquireShared")]),s._v("ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸‹è¿™å†…å®¹ã€‚")]),s._v(" "),t("li",[t("code",[s._v("Node.SHARED")]),s._v("ï¼Œå…¶å®æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡è®°ä½œç”¨ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å…±äº«ã€‚"),t("code",[s._v("final boolean isShared() { return nextWaiter == SHARED; }")])]),s._v(" "),t("li",[t("code",[s._v("tryAcquireShared")]),s._v("ï¼Œä¸»è¦æ˜¯æ¥è‡ª "),t("code",[s._v("Semaphore")]),s._v(" å…±äº«é”ä¸­å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚ç”¨æ¥è·å–åŒæ­¥çŠ¶æ€ã€‚")]),s._v(" "),t("li",[t("code",[s._v("setHeadAndPropagate(node, r)")]),s._v("ï¼Œå¦‚æœr > 0ï¼ŒåŒæ­¥æˆåŠŸååˆ™å°†å½“å‰çº¿ç¨‹ç»“ç‚¹è®¾ç½®ä¸ºå¤´ç»“ç‚¹ï¼ŒåŒæ—¶ helpGCï¼Œp.next = nullï¼Œæ–­é“¾æ“ä½œã€‚")]),s._v(" "),t("li",[t("code",[s._v("shouldParkAfterFailedAcquire(p, node)")]),s._v("ï¼Œè°ƒæ•´åŒæ­¥é˜Ÿåˆ—ä¸­ node ç»“ç‚¹çš„çŠ¶æ€ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦åº”è¯¥è¢«æŒ‚èµ·ã€‚è¿™åœ¨æˆ‘ä»¬ä¹‹å‰å…³äºé”çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»ã€‚")]),s._v(" "),t("li",[t("code",[s._v("parkAndCheckInterrupt()")]),s._v("ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¢«ä¸­æ–­ï¼Œå¦‚æœä¸­æ–­ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå½“å‰ç»“ç‚¹è¯·æ±‚ä¹Ÿå°±ç»“æŸã€‚")]),s._v(" "),t("li",[t("code",[s._v("cancelAcquire(node)")]),s._v("ï¼Œå–æ¶ˆè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹è¯·æ±‚ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_4-countdownlatch-å…±äº«é”ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-countdownlatch-å…±äº«é”ä½¿ç”¨"}},[s._v("#")]),s._v(" 4. CountDownLatch å…±äº«é”ä½¿ç”¨")]),s._v(" "),t("p",[s._v("CountDownLatch ä¹Ÿæ˜¯å…±äº«é”çš„ä¸€ç§ç±»å‹ï¼Œä¹‹æ‰€ä»¥åœ¨è¿™é‡Œä½“ç°ä¸‹ï¼Œæ˜¯å› ä¸ºå®ƒå’Œ Semaphore å…±äº«é”ï¼Œæ—¢ç›¸ä¼¼æœ‰ä¸åŒã€‚")]),s._v(" "),t("p",[s._v("CountDownLatch æ›´å¤šä½“ç°çš„ç»„å›¢ä¸€æ³¢çš„æ€æƒ³ï¼ŒåŒæ ·æ˜¯æ§åˆ¶äººæ•°ï¼Œä½†æ˜¯éœ€è¦å¤Ÿä¸€çªã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬è¯´è¿‡çš„4ä¸ªäººä¸€èµ·ä¸Šçš®åˆ’è‰‡ã€ä¸¤ä¸ªäººä¸€èµ·ä¸Šè··è··æ¿ã€"),t("em",[s._v("2ä¸ªäººä¸€èµ·è¹²å‘æˆ‘æ²¡è§è¿‡")]),s._v("ï¼Œè¿™æ ·çš„æ–¹å¼å°±æ˜¯é—¨é—© CountDownLatch é”çš„æ€æƒ³ã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),s._v(" latch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" exec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        exec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" millis "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Random")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nextInt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" millis "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(millis)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" ignore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                latch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("countDown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®Œäº‹ä¸€ä¸ªæ‰£å‡ä¸€ä¸ªåé¢")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…æ¸¸å®¢")]),s._v("\n    latch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"èˆ¹é•¿æ€¥èºäº†ï¼Œå¼€èˆ¹!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­çº¿ç¨‹æ± ")]),s._v("\n    exec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("è¿™ä¸€ä¸ªå…¬å›­æ¸¸èˆ¹çš„åœºæ™¯æ¡ˆä¾‹ï¼Œç­‰å¾…10ä¸ªä¹˜å®¢ä¸Šä¼ ï¼Œä»–ä»¬æ¯”è¾ƒå¢¨è¿¹ã€‚")]),s._v(" "),t("li",[s._v("ä¸Šä¸€ä¸ªæ‰£å‡ä¸€ä¸ª "),t("code",[s._v("latch.countDown()")])]),s._v(" "),t("li",[s._v("ç­‰å¾…æ¸¸å®¢éƒ½ä¸Šèˆ¹ "),t("code",[s._v("latch.await()")])]),s._v(" "),t("li",[s._v("æœ€åèˆ¹é•¿å¼€èˆ¹ï¼ï¼"),t("code",[s._v("æ€¥èºäº†")])])]),s._v(" "),t("p",[t("strong",[s._v("æµ‹è¯•ç»“æœ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("ç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("6689")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("2303")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("8208")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("435")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("9489")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("4937")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("2771")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("4823")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("1989")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nç­‰å¾…æ¸¸å®¢ä¸Šèˆ¹ï¼Œè€—æ—¶ï¼š"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("8506")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("millis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nèˆ¹é•¿æ€¥èºäº†ï¼Œå¼€èˆ¹"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Process")]),s._v(" finished "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("exit")]),s._v(" code "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("åœ¨ä½ å®é™…çš„æµ‹è¯•ä¸­ä¼šå‘ç°ï¼Œ"),t("code",[s._v("èˆ¹é•¿æ€¥èºäº†ï¼Œå¼€èˆ¹!")]),s._v("ï¼Œä¼šéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚")]),s._v(" "),t("li",[s._v("è¿™é‡Œä½“ç°çš„å°±æ˜¯é—¨é—©çš„æ€æƒ³ï¼Œç»„é˜Ÿã€ä¸€æ³¢å¸¦èµ°ã€‚")]),s._v(" "),t("li",[s._v("CountDownLatch çš„å®ç°ä¸ Semaphore  åŸºæœ¬ç›¸åŒã€ç»†èŠ‚ç•¥æœ‰å·®å¼‚ï¼Œå°±ä¸å†åšæºç åˆ†æäº†ã€‚")])]),s._v(" "),t("h2",{attrs:{id:"å››ã€æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€æ€»ç»“"}},[s._v("#")]),s._v(" å››ã€æ€»ç»“")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨æœ‰äº† AQSã€CLHã€MCSï¼Œç­‰ç›¸å…³é”çš„çŸ¥è¯†äº†è§£åï¼Œåœ¨å­¦ä¹ å…¶ä»–çŸ¥è¯†ç‚¹ä¹Ÿç›¸å¯¹å®¹æ˜“ã€‚åŸºæœ¬ä»¥ä¸Šå’Œå‰å‡ ç« èŠ‚å…³äºé”çš„ä»‹ç»ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­å®¹æ˜“é—®åˆ°çš„ç‚¹ã€‚"),t("em",[s._v("å¯èƒ½ç”±äºç›®å‰åˆ†å¸ƒå¼å¼€å‘è¾ƒå¤šï¼Œå•æœºçš„å¤šçº¿ç¨‹æ€§èƒ½å‹æ¦¨ä¸€èˆ¬è¾ƒå°‘ï¼Œä½†æ˜¯å¯¹è¿™éƒ¨åˆ†çŸ¥è¯†çš„äº†è§£éå¸¸é‡è¦")])]),s._v(" "),t("li",[s._v("å¾—ç›ŠäºLeeè€çˆ·å­çš„æ“åˆ€ï¼Œå¹¶å‘åŒ…é”çš„è®¾è®¡çœŸçš„éå¸¸ä¼˜ç§€ã€‚æ¯ä¸€å¤„çš„å®ç°éƒ½å¯ä»¥è¯´æ˜¯ç²¾ç›Šæ±‚ç²¾ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ çš„æ—¶å€™å¯ä»¥æŠŠå°å‚…å“¥çš„æ–‡ç« å½“ä½œæŠ›ç –ï¼Œä¹‹åç»§ç»­æ·±æŒ–è®¾è®¡ç²¾é«“ï¼Œä¸æ–­æ·±å…¥ã€‚")]),s._v(" "),t("li",[s._v("å…±äº«é”çš„ä½¿ç”¨å¯èƒ½å¹³æ—¶å¹¶ä¸å¤šï¼Œä½†å¦‚æœä½ éœ€è¦è®¾è®¡ä¸€æ¬¾ç±»ä¼¼æ•°æ®åº“çº¿ç¨‹æ± çš„è®¾è®¡ï¼Œé‚£ä¹ˆè¿™æ ·çš„ä¿¡å·é‡é”çš„æ€æƒ³å°±éå¸¸é‡è¦äº†ã€‚æ‰€ä»¥åœ¨å­¦ä¹ çš„æ—¶å€™ä¹Ÿéœ€è¦æœ‰æŠ€æœ¯è¿ç§»çš„èƒ½ï¼Œä¸æ–­æŠŠè¿™äº›çŸ¥è¯†å¤ç”¨åˆ°å®é™…çš„ä¸šåŠ¡å¼€å‘ä¸­ã€‚")])])])}),[],!1,null,null,null);t.default=e.exports}}]);