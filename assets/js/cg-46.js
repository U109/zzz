(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{338:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"é¢ç»æ‰‹å†Œ-Â·-ç¬¬17ç¯‡ã€Šç å†œä¼šé”-reentrantlockä¹‹aqsåŸç†åˆ†æå’Œå®è·µä½¿ç”¨ã€‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¢ç»æ‰‹å†Œ-Â·-ç¬¬17ç¯‡ã€Šç å†œä¼šé”-reentrantlockä¹‹aqsåŸç†åˆ†æå’Œå®è·µä½¿ç”¨ã€‹"}},[s._v("#")]),s._v(" é¢ç»æ‰‹å†Œ Â· ç¬¬17ç¯‡ã€Šç å†œä¼šé”ï¼ŒReentrantLockä¹‹AQSåŸç†åˆ†æå’Œå®è·µä½¿ç”¨ã€‹")]),s._v(" "),t("p",[s._v("ä½œè€…ï¼šå°å‚…å“¥\n"),t("br"),s._v("åšå®¢ï¼š"),t("a",{attrs:{href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://bugstack.cn"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")])]),s._v(" "),t("h2",{attrs:{id:"ä¸€ã€å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€å‰è¨€"}},[s._v("#")]),s._v(" ä¸€ã€å‰è¨€")]),s._v(" "),t("p",[t("code",[s._v("å¦‚æœä½ ç›¸ä¿¡ä½ åšä»€ä¹ˆéƒ½èƒ½æˆï¼Œä½ ä¼šè‡ªä¿¡çš„å¤šï¼")])]),s._v(" "),t("p",[s._v("åƒä¸‡ä¸è¦æ€»è‡ªæˆ‘å¦å®šï¼Œå°¤å…¶æ˜¯èŒåœºçš„æ‰“å·¥äººã€‚å¦‚æœä½ ç»å¸¸æ„Ÿè§‰ï¼Œè¿™ä¸ªåšä¸å¥½ï¼Œé‚£ä¸ªå­¦ä¸ä¼šï¼Œåˆ«çš„ä¹Ÿä¸æ‡‚ï¼Œé‚£ä¹ˆä¹…è€Œä¹…ä¹‹ä¼šè¶Šæ¥è¶Šç¼ºä¹è‡ªä¿¡ã€‚")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬è¯´èƒ½æˆäº‹çš„äººéƒ½å…·æœ‰"),t("code",[s._v("èµŒå¾’")]),s._v("ç²¾ç¥ï¼Œåœ¨ä»–ä»¬çœ¼é‡Œåªè¦åšè¿™äº‹é‚£å°±ä¸€å®šèƒ½æˆï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æœ€åå°±æ²¡æˆï¼Œä½†åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­äººçš„å¿ƒæ€æ˜¯è‰¯å¥½çš„ï¼Œæ¯å¤©éƒ½æœ‰ä¸€ä¸ªé¥±æ»¡çš„ç²¾ç¥çŠ¶æ€ï¼Œå­œå­œä¸å€¦çš„å¥‹æ–—ç€ã€‚æœ€åä¹Ÿå°±æ˜¯è¿™æ ·çš„æ–—å¿—è®©èµ°åœ¨ä¸€ä¸ªèµ·ç‚¹çš„å°ä¼™ä¼´ï¼Œæœ‰äº†å·®è·ã€‚")]),s._v(" "),t("h2",{attrs:{id:"äºŒã€é¢è¯•é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€é¢è¯•é¢˜"}},[s._v("#")]),s._v(" äºŒã€é¢è¯•é¢˜")]),s._v(" "),t("p",[t("code",[s._v("è°¢é£æœºï¼Œå°è®°")]),s._v("ï¼Œä»Šå¤©æ‰“å·¥äººå‘€ï¼Œæ˜å¤©æ—©ä¸Šå›°å‘€ï¼Œå˜Ÿå˜Ÿå˜Ÿï¼Œå–‚ï¼Ÿè°å‘€ï¼Œæ‰“å†œè¯å‘¢ï¼ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå“å‘¦ï¼Œé¢è¯•å®˜å¤§å“¥ï¼Œå’‹äº†ï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šå·å·å‘Šè¯‰ä½ å“ˆï¼Œä½ ä¸€é¢è¿‡äº†ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šå˜¿å˜¿ï¼ŒçœŸçš„å‘€ï¼å¤ªå¥½äº†ï¼å“ˆå“ˆå“ˆï¼Œé‚£æˆ‘è¿˜å‡†å¤‡ç‚¹ä»€ä¹ˆå‘¢ï¼ï¼Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šäºŒé¢ä¼šæ¯”è¾ƒéš¾å–½ï¼Œå—¯ï¼Œæˆ‘é¡ºä¾¿é—®ä½ ä¸€ä¸ªå“ˆã€‚AQS ä½ äº†è§£å—ï¼ŒReentrantLock è·å–é”çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿä»€ä¹ˆæ˜¯ CASï¼Ÿ...")]),s._v(" "),t("p",[t("strong",[s._v("è°¢é£æœº")]),s._v("ï¼šæˆ‘æˆ‘æˆ‘ï¼Œ"),t("em",[s._v("è„‘å­è¿˜åœ¨åç¾¿å°„ç®­é‡Œ")]),s._v("ï¼Œæˆ‘ä¸€ä¼šå°±çœ‹çœ‹ï¼ï¼")]),s._v(" "),t("p",[t("strong",[s._v("é¢è¯•å®˜")]),s._v("ï¼šå¥½å¥½å‡†å¤‡ä¸‹å§ï¼Œæ‰“å·¥äººï¼Œæ‰“å·¥é­‚ï¼")]),s._v(" "),t("h2",{attrs:{id:"ä¸‰ã€reentrantlock-å’Œ-aqs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€reentrantlock-å’Œ-aqs"}},[s._v("#")]),s._v(" ä¸‰ã€ReentrantLock å’Œ AQS")]),s._v(" "),t("h3",{attrs:{id:"_1-reentrantlock-çŸ¥è¯†é“¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-reentrantlock-çŸ¥è¯†é“¾"}},[s._v("#")]),s._v(" 1. ReentrantLock çŸ¥è¯†é“¾")]),s._v(" "),t("p",[s._v("ReentrantLock å¯é‡å…¥ç‹¬å é”æ¶‰åŠçš„çŸ¥è¯†ç‚¹è¾ƒå¤šï¼Œä¸ºäº†æ›´å¥½çš„å­¦ä¹ è¿™äº›çŸ¥è¯†ï¼Œåœ¨ä¸Šä¸€ç« èŠ‚å…ˆåˆ†ææºç å’Œå­¦ä¹ å®ç°äº†å…¬å¹³é”çš„å‡ ç§æ–¹æ¡ˆã€‚åŒ…æ‹¬ï¼šCLHã€MCSã€Ticketï¼Œé€šè¿‡è¿™éƒ¨åˆ†å†…å®¹çš„å­¦ä¹ ï¼Œå†æ¥ç†è§£ ReentrantLock ä¸­å…³äº CLH çš„å˜ä½“å®ç°å’Œç›¸åº”çš„åº”ç”¨å°±æ¯”è¾ƒå®¹æ˜“äº†ã€‚")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥æ²¿ç€ ReentrantLock çš„çŸ¥è¯†é“¾ï¼Œç»§ç»­åˆ†æ AQS ç‹¬å é”çš„ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå¦‚å›¾ 17-1")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 17-1 ReentrantLock çš„çŸ¥è¯†é“¾","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-17-1.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("åœ¨è¿™éƒ¨åˆ†çŸ¥è¯†å­¦ä¹ ä¸­ï¼Œä¼šä¸»è¦å›´ç»• ReentrantLock ä¸­å…³äº AQS çš„ä½¿ç”¨è¿›è¡Œå±•å¼€ï¼Œé€æ­¥åˆ†ææºç äº†è§£åŸç†ã€‚")]),s._v(" "),t("p",[s._v("AQS æ˜¯ AbstractQueuedSynchronizer çš„ç¼©å†™ï¼Œå‡ ä¹æ‰€æœ‰ Lock éƒ½æ˜¯åŸºäº AQS æ¥å®ç°äº†ï¼Œå…¶åº•å±‚å¤§é‡ä½¿ç”¨ CAS æä¾›ä¹è§‚é”æœåŠ¡ï¼Œåœ¨å†²çªæ—¶é‡‡ç”¨è‡ªæ—‹æ–¹å¼è¿›è¡Œé‡è¯•ï¼Œä»¥æ­¤å®ç°è½»é‡çº§å’Œé«˜æ•ˆçš„è·å–é”ã€‚")]),s._v(" "),t("p",[s._v("å¦å¤– AbstractQueuedSynchronizer æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†å¹¶æ²¡æœ‰å®šä¹‰ç›¸åº”çš„æŠ½è±¡æ–¹æ³•ï¼Œè€Œæ˜¯æä¾›äº†å¯ä»¥è¢«å­—ç±»ç»§æ‰¿æ—¶è¦†ç›–çš„ protected çš„æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ”¯æŒç»§æ‰¿ç±»çš„ä½¿ç”¨ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_2-å†™ä¸€ä¸ªç®€å•çš„-aqs-åŒæ­¥ç±»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†™ä¸€ä¸ªç®€å•çš„-aqs-åŒæ­¥ç±»"}},[s._v("#")]),s._v(" 2. å†™ä¸€ä¸ªç®€å•çš„ AQS åŒæ­¥ç±»")]),s._v(" "),t("p",[s._v("åœ¨å­¦ä¹  ReentrantLock ä¸­åº”ç”¨çš„ AQS ä¹‹å‰ï¼Œå…ˆå®ç°ä¸€ä¸ªç®€å•çš„åŒæ­¥ç±»ï¼Œæ¥ä½“ä¼šä¸‹ AQS çš„ä½œç”¨ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_2-1-ä»£ç å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-ä»£ç å®ç°"}},[s._v("#")]),s._v(" 2.1 ä»£ç å®ç°")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SyncLock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sync")]),s._v(" sync"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SyncLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sync "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sync"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sync"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractQueuedSynchronizer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryRelease")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºï¼Œåªæœ‰ç”¨åˆ° Condition æ‰éœ€è¦å»å®ç°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isHeldExclusively")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("è¿™ä¸ªå®ç°çš„è¿‡ç¨‹å±äº ReentrantLock ç®€ç‰ˆï¼Œä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("Sync ç±»ç»§æ‰¿ AbstractQueuedSynchronizerï¼Œå¹¶é‡å†™æ–¹æ³•ï¼štryAcquireã€tryReleaseã€isHeldExclusivelyã€‚")]),s._v(" "),t("li",[s._v("è¿™ä¸‰ä¸ªæ–¹æ³•åŸºæœ¬æ˜¯å¿…é¡»é‡å†™çš„ï¼Œå¦‚æœä¸é‡å†™åœ¨ä½¿ç”¨çš„æ—¶å€™å°±ä¼šæŠ›å¼‚å¸¸ "),t("code",[s._v("UnsupportedOperationException")]),s._v("ã€‚")]),s._v(" "),t("li",[s._v("é‡å†™çš„è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ AQS æä¾›çš„ CAS æ–¹æ³•ã€‚ä»¥é¢„æœŸå€¼ä¸º 0ï¼Œå†™å…¥æ›´æ–°å€¼ 1ï¼Œå†™å…¥æˆåŠŸåˆ™è·å–é”æˆåŠŸã€‚å…¶å®è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å¯¹ state ä½¿ç”¨ "),t("code",[s._v("unsafe")]),s._v(" æœ¬åœ°æ–¹æ³•ï¼Œä¼ é€’åç§»é‡ stateOffset ç­‰å‚æ•°ï¼Œè¿›è¡Œå€¼äº¤æ¢æ“ä½œã€‚"),t("code",[s._v("unsafe.compareAndSwapInt(this, stateOffset, expect, update)")])]),s._v(" "),t("li",[s._v("æœ€åæä¾› lockã€unlock ä¸¤ä¸ªæ–¹æ³•ï¼Œå®é™…çš„ç±»ä¸­ä¼šå®ç° Lock æ¥å£ä¸­çš„ç›¸åº”æ–¹æ³•ï¼Œè¿™é‡Œä¸ºäº†ç®€åŒ–ç›´æ¥è‡ªå®šä¹‰è¿™æ ·ä¸¤ä¸ªæ–¹æ³•ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_2-2-å•å…ƒæµ‹è¯•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-å•å…ƒæµ‹è¯•"}},[s._v("#")]),s._v(" 2.2 å•å…ƒæµ‹è¯•")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test_SyncLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SyncLock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SyncLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestLock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SyncLock")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SyncLock")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//éœ€è¦è®¾ç½®ä¸€ä¸ªéšæœºä¼‘çœ æ—¶é—´æ¥éªŒè¯ç»“æœï¼Œçº¿ç¨‹æ˜¯æ¯200æ¯«ç§’åˆ›å»ºä¸€ä¸ªï¼Œ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ¯ä¸ªçº¿ç¨‹éƒ½ä¼‘çœ ç›¸åŒçš„æ—¶é—´ï¼Œå…ˆåˆ›å»ºçš„çº¿ç¨‹è‚¯å®šä¼šå…ˆæ‰§è¡Œå®Œçš„ï¼Œå°±ç®—ä¸åŠ å…¬å¹³é”ï¼Œç»“æœä»ç„¶æ˜¯é¡ºåºè¾“å‡º")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" randomNumber "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ceil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("random")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("randomNumber"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread %s Completed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("ul",[t("li",[s._v("ä»¥ä¸Šè¿™ä¸ªå•å…ƒæµ‹è¯•å’Œæˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚ä»‹ç»å…¬å¹³é”æ—¶æ˜¯ä¸€æ ·çš„ï¼ŒéªŒè¯é¡ºåºè¾“å‡ºã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¤šçº¿ç¨‹æ“ä½œä¸€ä¸ªæ–¹æ³•è¿›è¡ŒåŠ å’Œè¿ç®—ã€‚")]),s._v(" "),t("li",[s._v("åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­å¯ä»¥å°è¯•æŠŠåŠ é”ä»£ç æ³¨é‡Šæ‰ï¼Œè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœå¯ä»¥é¡ºåºè¾“å‡ºï¼Œé‚£ä¹ˆå°±æ˜¯é¢„æœŸç»“æœã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("æµ‹è¯•ç»“æœ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Completed")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("ä»æµ‹è¯•ç»“æœçœ‹ï¼Œä»¥ä¸Š AQS å®ç°çš„åŒæ­¥ç±»ï¼Œæ»¡è¶³é¢„æœŸæ•ˆæœã€‚")]),s._v(" "),t("li",[s._v("æœ‰äº†è¿™æ®µä»£ç çš„æ¦‚å¿µç»“æ„ï¼Œæ¥ä¸‹æ¥åœ¨åˆ†æ ReentrantLock ä¸­çš„ AQS ä½¿ç”¨å°±æœ‰ä¸€å®šçš„æ„Ÿè§‰äº†ï¼")])]),s._v(" "),t("h3",{attrs:{id:"_3-cas-ä»‹ç»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-cas-ä»‹ç»"}},[s._v("#")]),s._v(" 3. CAS ä»‹ç»")]),s._v(" "),t("p",[s._v("CAS æ˜¯ compareAndSet çš„ç¼©å†™ï¼Œå®ƒçš„åº”ç”¨åœºæ™¯å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œå€¼å˜æ›´ï¼Œåœ¨å˜æ›´æ—¶ä¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯é¢„æœŸå€¼ã€å¦å¤–ä¸€ä¸ªæ˜¯æ›´æ–°å€¼ã€‚å¦‚æœè¢«æ›´æ–°çš„å˜é‡é¢„æœŸå€¼ä¸ä¼ å…¥å€¼ä¸€è‡´ï¼Œåˆ™å¯ä»¥å˜æ›´ã€‚")]),s._v(" "),t("p",[s._v("CAS çš„å…·ä½“æ“ä½œä½¿ç”¨åˆ°äº† "),t("code",[s._v("unsafe")]),s._v(" ç±»ï¼Œåº•å±‚ç”¨åˆ°äº†æœ¬åœ°æ–¹æ³• "),t("code",[s._v("unsafe.compareAndSwapInt")]),s._v(" æ¯”è¾ƒäº¤æ¢æ–¹æ³•ã€‚")]),s._v(" "),t("p",[s._v("CAS æ˜¯ä¸€ç§æ— é”ç®—æ³•ï¼Œè¿™ç§æ“ä½œæ˜¯ CPU æŒ‡ä»¤é›†æ“ä½œï¼Œåªæœ‰ä¸€æ­¥åŸå­æ“ä½œï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚è€Œä¸” CAS é¿å…äº†è¯·æ±‚æ“ä½œç³»ç»Ÿæ¥è£å®šé”é—®é¢˜ï¼Œç›´æ¥ç”± CPU æå®šï¼Œä½†ä¹Ÿä¸æ˜¯æ²¡æœ‰å¼€é”€ï¼Œæ¯”å¦‚ Cache Missï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œäº†è§£ CPU ç¡¬ä»¶ç›¸å…³çŸ¥è¯†ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_4-aqs-æ ¸å¿ƒæºç åˆ†æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-aqs-æ ¸å¿ƒæºç åˆ†æ"}},[s._v("#")]),s._v(" 4. AQS æ ¸å¿ƒæºç åˆ†æ")]),s._v(" "),t("h4",{attrs:{id:"_4-1-è·å–é”æµç¨‹å›¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-è·å–é”æµç¨‹å›¾"}},[s._v("#")]),s._v(" 4.1 è·å–é”æµç¨‹å›¾")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 17-2 è·å–é”æµç¨‹å›¾","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-17-2.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("å›¾ 17-2 å°±æ˜¯æ•´ä¸ª ReentrantLock ä¸­è·å–é”çš„æ ¸å¿ƒæµç¨‹ï¼ŒåŒ…æ‹¬éå…¬å¹³é”å’Œå…¬å¹³é”çš„ä¸€äº›äº¤å‰æµç¨‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»¥æ­¤æŒ‰ç…§æ­¤æµç¨‹æ¥è®²è§£ç›¸åº”çš„æºç éƒ¨åˆ†ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_4-2-lock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-lock"}},[s._v("#")]),s._v(" 4.2 lock")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"å›¾ 17-3 lock -> CAS","data-src":"https://bugstack.cn/assets/images/2020/interview/interview-17-3.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("ReentrantLock å®ç°äº†éå…¬å¹³é”å’Œå…¬å¹³é”ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨ "),t("code",[s._v("lock.lock();")]),s._v(" æ—¶ï¼Œä¼šæœ‰ä¸åŒçš„å®ç°ç±»ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("éå…¬å¹³é”ï¼Œä¼šç›´æ¥ä½¿ç”¨ CAS è¿›è¡ŒæŠ¢å ï¼Œä¿®æ”¹å˜é‡ state å€¼ã€‚å¦‚æœæˆåŠŸåˆ™ç›´æ¥æŠŠè‡ªå·±çš„çº¿ç¨‹è®¾ç½®åˆ° exclusiveOwnerThreadï¼Œä¹Ÿå°±æ˜¯è·å¾—é”æˆåŠŸã€‚"),t("em",[s._v("ä¸æˆåŠŸåç»­åˆ†æ")])]),s._v(" "),t("li",[s._v("å…¬å¹³é”ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒæŠ¢å ï¼Œè€Œæ˜¯è§„è§„çŸ©çŸ©çš„è¿›è¡Œæ’é˜Ÿã€‚"),t("em",[s._v("è€å®äºº")])])]),s._v(" "),t("h4",{attrs:{id:"_4-3-compareandsetstate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-compareandsetstate"}},[s._v("#")]),s._v(" 4.3 compareAndSetState")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setExclusiveOwnerThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("åœ¨éå…¬å¹³é”çš„å®ç°ç±»é‡Œï¼Œè·å–é”çš„è¿‡ç¨‹ï¼Œæœ‰è¿™æ ·ä¸€æ®µ CAS æ“ä½œçš„ä»£ç ã€‚"),t("code",[s._v("compareAndSetState")]),s._v(" èµ‹å€¼æˆåŠŸåˆ™è·å–é”ã€‚é‚£ä¹ˆ CAS è¿™é‡Œé¢åšäº†ä»€ä¹ˆæ“ä½œï¼Ÿ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// See below for intrinsics setup to support this")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" unsafe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSwapInt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stateOffset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("å¾€ä¸‹ç¿»æˆ‘ä»¬çœ‹åˆ°è¿™æ ·ä¸€æ®µä»£ç ï¼Œè¿™é‡Œæ˜¯ unsafe åŠŸèƒ½ç±»çš„ä½¿ç”¨ï¼Œä¸¤ä¸ªå‚æ•°åˆ°è¿™é‡Œå˜æˆå››ä¸ªå‚æ•°ã€‚å¤šäº† thisã€stateOffsetã€‚this æ˜¯å¯¹è±¡æœ¬èº«ï¼Œé‚£ä¹ˆ stateOffset æ˜¯ä»€ä¹ˆï¼Ÿ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("stateOffset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" unsafe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objectFieldOffset\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractQueuedSynchronizer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDeclaredField")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"state"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å†å¾€ä¸‹çœ‹æˆ‘ä»¬æ‰¾åˆ°ï¼ŒstateOffset æ˜¯åç§»é‡å€¼ï¼Œåç§»é‡æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹è¿™ä¸ªå€¼åˆ°åº•æ˜¯å¤šå°‘ï¼")]),s._v(" "),t("p",[t("strong",[s._v("å¼•ç”¨POM jol-cli")])]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- https://mvnrepository.com/artifact/org.openjdk.jol/jol-cli --\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.openjdk.jol"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jol-cli"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("0.14"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("å•å…ƒæµ‹è¯•")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test_stateOffset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Unsafe")]),s._v(" unsafe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUnsafeInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" state "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" unsafe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objectFieldOffset\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractQueuedSynchronizer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDeclaredField")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"state"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 16")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("é€šè¿‡ getUnsafeInstance æ–¹æ³•è·å– Unsafeï¼Œè¿™æ˜¯ä¸€ä¸ªå›ºå®šçš„æ–¹æ³•ã€‚")]),s._v(" "),t("li",[s._v("åœ¨è·å– AQS ç±»ä¸­çš„å±æ€§å­—æ®µ state çš„åç§»é‡ï¼Œ16ã€‚")]),s._v(" "),t("li",[s._v("é™¤äº†è¿™ä¸ªå±æ€§å¤–ä½ è¿˜å¯ä»¥æ‹¿åˆ°ï¼šheadOffsetã€tailOffsetã€waitStatusOffsetã€nextOffsetï¼Œçš„å€¼ï¼Œæœ€ç»ˆè‡ªæ—‹æ¥å˜æ›´è¿™äº›å˜é‡çš„å€¼ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_4-4-aqs-acquire"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-aqs-acquire"}},[s._v("#")]),s._v(" 4.4 (AQS)acquire")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquireQueued")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWaiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EXCLUSIVE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selfInterrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("æ•´ä¸ªè¿™å—ä»£ç é‡Œé¢åŒ…å«äº†å››ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼Œå¦‚ä¸‹ï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("tryAcquire")]),s._v("ï¼Œåˆ†åˆ«ç”±ç»§æ‰¿ AQS çš„å…¬å¹³é”ï¼ˆFairSyncï¼‰ã€éå…¬å¹³é”ï¼ˆNonfairSyncï¼‰å®ç°ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("addWaiter")]),s._v("ï¼Œè¯¥æ–¹æ³•æ˜¯ AQS çš„ç§æœ‰æ–¹æ³•ï¼Œä¸»è¦ç”¨é€”æ˜¯æ–¹æ³• "),t("strong",[s._v("tryAcquire")]),s._v(" è¿”å› false ä»¥åï¼Œä¹Ÿå°±æ˜¯è·å–é”å¤±è´¥ä»¥åï¼ŒæŠŠå½“å‰è¯·æ±‚é”çš„çº¿ç¨‹æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶è¿”å› Node èŠ‚ç‚¹ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("acquireQueued")]),s._v("ï¼Œè´Ÿè´£æŠŠ addWaiter è¿”å›çš„ Node èŠ‚ç‚¹æ·»åŠ åˆ°é˜Ÿåˆ—ç»“å°¾ï¼Œå¹¶ä¼šæ‰§è¡Œè·å–é”æ“ä½œä»¥åŠåˆ¤æ–­æ˜¯å¦æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("selfInterrupt")]),s._v("ï¼Œæ˜¯ AQS ä¸­çš„ "),t("code",[s._v("Thread.currentThread().interrupt()")]),s._v(" æ–¹æ³•è°ƒç”¨ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯åœ¨æ‰§è¡Œå®Œ acquire ä¹‹å‰è‡ªå·±æ‰§è¡Œä¸­æ–­æ“ä½œã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_4-5-tryacquire"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-tryacquire"}},[s._v("#")]),s._v(" 4.5 tryAcquire")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nonfairTryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setExclusiveOwnerThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExclusiveOwnerThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" nextc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" acquires"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// overflow")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Maximum lock count exceeded"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("è¿™éƒ¨åˆ†è·å–é”çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æœ "),t("code",[s._v("c == 0")]),s._v("ï¼Œé”æ²¡æœ‰è¢«å ç”¨ï¼Œå°è¯•ä½¿ç”¨ CAS æ–¹å¼è·å–é”ï¼Œå¹¶è¿”å› trueã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœ "),t("code",[s._v("current == getExclusiveOwnerThread()")]),s._v("ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é”ï¼Œåˆ™éœ€è¦è°ƒç”¨ "),t("code",[s._v("setState")]),s._v("  è¿›è¡Œé”é‡å…¥æ“ä½œã€‚"),t("em",[s._v("setState ä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºæ˜¯åœ¨è‡ªå·±çš„å½“å‰çº¿ç¨‹ä¸‹ã€‚")])]),s._v(" "),t("li",[s._v("æœ€åå¦‚æœä¸¤ç§éƒ½ä¸æ»¡è¶³ğŸ˜Œï¼Œåˆ™è¿”å› falseã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_4-6-addwaiter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-addwaiter"}},[s._v("#")]),s._v(" 4.6 addWaiter")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWaiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" pred "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©º, ä½¿ç”¨ CAS æ–¹å¼å°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºå°¾èŠ‚ç‚¹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pred "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetTail")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é˜Ÿåˆ—ä¸ºç©ºã€CASå¤±è´¥ï¼Œå°†èŠ‚ç‚¹æ’å…¥é˜Ÿåˆ—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("enq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("å½“æ‰§è¡Œæ–¹æ³• "),t("code",[s._v("addWaiter")]),s._v("ï¼Œé‚£ä¹ˆå°±æ˜¯ "),t("code",[s._v("!tryAcquire = true")]),s._v("ï¼Œä¹Ÿå°±æ˜¯ tryAcquire è·å–é”å¤±è´¥äº†ã€‚")]),s._v(" "),t("li",[s._v("æ¥ä¸‹æ¥å°±æ˜¯æŠŠå½“å‰çº¿ç¨‹å°è£…åˆ° Node èŠ‚ç‚¹ä¸­ï¼ŒåŠ å…¥åˆ° FIFO é˜Ÿåˆ—ä¸­ã€‚"),t("em",[s._v("å› ä¸ºå…ˆè¿›å…ˆå‡ºï¼Œæ‰€ä»¥åæ¥çš„é˜Ÿåˆ—åŠ å…¥åˆ°é˜Ÿå°¾")])]),s._v(" "),t("li",[t("code",[s._v("compareAndSetTail")]),s._v(" ä¸ä¸€å®šä¸€å®šæˆåŠŸï¼Œå› ä¸ºåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°æ“ä½œå¤±è´¥ã€‚é‚£ä¹ˆå¤±è´¥åï¼Œåˆ™éœ€è¦è°ƒç”¨ enq æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè‡ªæ—‹æ“ä½œï¼ŒæŠŠèŠ‚ç‚¹å…¥é˜Ÿåˆ—ã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("enq")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("enq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Must initialize")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetHead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                tail "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" head"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetTail")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("è‡ªæ—‹è½¬"),t("code",[s._v("forå¾ªç¯")]),s._v(" +  CAS å…¥é˜Ÿåˆ—ã€‚")]),s._v(" "),t("li",[s._v("å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œåˆ™ä¼šæ–°åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŠŠå°¾èŠ‚ç‚¹æŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œç„¶åç»§ç»­å¾ªç¯ã€‚")]),s._v(" "),t("li",[s._v("ç¬¬äºŒæ¬¡å¾ªç¯æ—¶ï¼Œåˆ™ä¼šæŠŠå½“å‰çº¿ç¨‹çš„èŠ‚ç‚¹æ·»åŠ åˆ°é˜Ÿå°¾ã€‚"),t("em",[s._v("head èŠ‚æ˜¯ä¸€ä¸ªæ— ç”¨èŠ‚ç‚¹ï¼Œè¿™å’Œæˆ‘ä»¬åšCLHå®ç°æ—¶ç±»ä¼¼")])])]),s._v(" "),t("p",[t("strong",[s._v("æ³¨æ„ï¼Œä»å°¾èŠ‚ç‚¹é€†å‘éå†")])]),s._v(" "),t("ol",[t("li",[s._v("é¦–å…ˆè¿™é‡Œçš„èŠ‚ç‚¹è¿æ¥æ“ä½œå¹¶ä¸æ˜¯åŸå­ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸ªåˆ«èŠ‚ç‚¹å¹¶æ²¡æœ‰è®¾ç½® next å€¼ï¼Œå°±å¤±è´¥äº†ã€‚")]),s._v(" "),t("li",[s._v("ä½†è¿™äº›èŠ‚ç‚¹çš„ prev æ˜¯æœ‰å€¼çš„ï¼Œæ‰€ä»¥éœ€è¦é€†å‘éå†ï¼Œè®© prev å±æ€§é‡æ–°æŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹ï¼Œç›´è‡³å…¨éƒ¨è‡ªæ—‹å…¥é˜Ÿåˆ—ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_4-7-acquirequeued"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-acquirequeued"}},[s._v("#")]),s._v(" 4.7 acquireQueued")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquireQueued")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" failed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" interrupted "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("predecessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰èŠ‚ç‚¹çš„å‰é©±å°±æ˜¯headèŠ‚ç‚¹æ—¶, å†æ¬¡å°è¯•è·å–é”")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" head "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// help GC")]),s._v("\n                failed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" interrupted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–é”å¤±è´¥å, åˆ¤æ–­æ˜¯å¦æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldParkAfterFailedAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parkAndCheckInterrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                interrupted "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("failed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cancelAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("å½“è·å–é”æµç¨‹èµ°åˆ°è¿™ï¼Œè¯´æ˜èŠ‚ç‚¹å·²ç»åŠ å…¥é˜Ÿåˆ—å®Œæˆã€‚çœ‹æºç ä¸­æ¥ä¸‹æ¥å°±æ˜¯è®©è¯¥æ–¹æ³•å†æ¬¡å°è¯•è·å–é”ï¼Œå¦‚æœè·å–é”å¤±è´¥ä¼šåˆ¤æ–­æ˜¯å¦æŠŠçº¿ç¨‹æŒ‚èµ·ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("setHead")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    head "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("åœ¨å­¦ä¹  CLH å…¬å¹³é”æ•°æ®ç»“æ„ä¸­è®²åˆ°HeadèŠ‚ç‚¹æ˜¯ä¸€ä¸ªè™šèŠ‚ç‚¹ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯HeadèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯´æ˜æ­¤æ—¶NodeèŠ‚ç‚¹æ’åœ¨é˜Ÿåˆ—æœ€å‰é¢ï¼Œå¯ä»¥å°è¯•è·å–é”ã€‚")]),s._v(" "),t("p",[s._v("è·å–é”åè®¾ç½®HeadèŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªå‡ºé˜Ÿåˆ—è¿‡ç¨‹ï¼ŒåŸæ¥èŠ‚ç‚¹è®¾ç½®Nullæ–¹ä¾¿GCã€‚")]),s._v(" "),t("p",[t("strong",[s._v("shouldParkAfterFailedAcquire")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldParkAfterFailedAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" ws "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("waitStatus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ws "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIGNAL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// SIGNAL è®¾ç½®äº†å‰ä¸€ä¸ªèŠ‚ç‚¹å®Œç»“å”¤é†’ï¼Œå®‰å¿ƒå¹²åˆ«çš„å»äº†ï¼Œè¿™é‡Œæ˜¯ç¡ã€‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ws "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pred "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("waitStatus "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetWaitStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pred"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ws"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIGNAL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("ä½ æ˜¯å¦è¿˜CANCELLEDã€SIGNALã€CONDITION ã€PROPAGATE ï¼Œè¿™å››ç§çŠ¶æ€ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ç”¨åˆ°äº†ä¸¤ç§å¦‚ä¸‹ï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("CANCELLED")]),s._v("ï¼Œå–æ¶ˆæ’é˜Ÿï¼Œæ”¾å¼ƒè·å–é”ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("SIGNAL")]),s._v("ï¼Œæ ‡è¯†å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€å·²ç»è¢«æŒ‚èµ·ï¼Œæ„æ€å°±æ˜¯å¤§å®¶ä¸€èµ·æ’é˜Ÿä¸Šå•æ‰€ï¼Œé˜Ÿä¼å¤ªé•¿äº†ï¼Œåé¢çš„è°¢é£æœºè¯´ï¼Œæˆ‘å»ä¹°ä¸ªæ²¹æ¡å“ˆï¼Œä¸€ä¼šåˆ°æˆ‘äº†ï¼Œä½ å¾®ä¿¡æˆ‘å“ˆã€‚å…¶å®å°±æ˜¯å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œéœ€è¦é¢å¤–æ‰§è¡Œå”¤é†’åç»§èŠ‚ç‚¹æ“ä½œã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("é‚£ä¹ˆ")]),s._v("ï¼Œä»¥ä¸Šè¿™æ®µä»£ç ä¸»è¦çš„æ‰§è¡Œå†…å®¹åŒ…æ‹¬ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€æ˜¯ "),t("code",[s._v("SIGNAL")]),s._v("ï¼Œåˆ™è¿”å› trueã€‚"),t("em",[s._v("å®‰å¿ƒç¡è§‰ğŸ˜ªç­‰ç€è¢«å«é†’")])]),s._v(" "),t("li",[s._v("å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€æ˜¯ "),t("code",[s._v("CANCELLED")]),s._v("ï¼Œå°±æ˜¯å®ƒæ”¾å¼ƒäº†ï¼Œåˆ™ç»§ç»­å‘å‰å¯»æ‰¾å…¶ä»–èŠ‚ç‚¹ã€‚")]),s._v(" "),t("li",[s._v("æœ€åå¦‚æœä»€ä¹ˆéƒ½æ²¡æ‰¾åˆ°ï¼Œå°±ç»™å‰ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸ªé—¹é’Ÿ "),t("code",[s._v("SIGNAL")]),s._v("ï¼Œç­‰ç€è¢«é€šçŸ¥ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_4-8-parkandcheckinterrupt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-parkandcheckinterrupt"}},[s._v("#")]),s._v(" 4.8 parkAndCheckInterrupt")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldParkAfterFailedAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parkAndCheckInterrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    interrupted "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹æŒ‚èµ·ç­‰å¾…è¢«å”¤é†’    ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parkAndCheckInterrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LockSupport")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("park")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("å½“æ–¹æ³• "),t("code",[s._v("shouldParkAfterFailedAcquire")]),s._v(" è¿”å› false æ—¶ï¼Œä»£è¡¨åŒæ­¥å™¨æ”¹å˜äº†å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ä¸º "),t("code",[s._v("SIGNAL")]),s._v("ï¼Œåœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œ "),t("code",[s._v("shouldParkAfterFailedAcquire")]),s._v(" è¿”å› trueï¼Œå†æ‰§è¡Œ parkAndCheckInterrupt() æ–¹æ³•ã€‚")]),s._v(" "),t("li",[s._v("é‚£ä¹ˆï¼Œè¿™ä¸€æ®µä»£ç å°±æ˜¯å¯¹çº¿ç¨‹çš„æŒ‚èµ·æ“ä½œï¼Œ"),t("code",[s._v("LockSupport.park(this);")]),s._v("ã€‚")]),s._v(" "),t("li",[t("code",[s._v("Thread.interrupted()")]),s._v(" æ£€æŸ¥å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡è¯†ã€‚")])]),s._v(" "),t("h2",{attrs:{id:"å››ã€æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€æ€»ç»“"}},[s._v("#")]),s._v(" å››ã€æ€»ç»“")]),s._v(" "),t("ul",[t("li",[s._v("ReentrantLock çš„çŸ¥è¯†æ¯”è¾ƒå¤šï¼Œæ¶‰åŠçš„ä»£ç é€»è¾‘ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­éœ€è¦å¯¹ç…§æºç å’Œç›¸å…³å¹¶å‘ä¹¦ç±å’Œèµ„æ–™ä¸€èµ·å­¦ä¹ ï¼Œä»¥åŠæœ€å¥½çš„æ˜¯è‡ªèº«å®è·µã€‚")]),s._v(" "),t("li",[s._v("AQS çš„å®ç°éƒ¨åˆ†æ¶‰åŠçš„å†…å®¹è¾ƒå¤šï¼Œä¾‹å¦‚ï¼šstate å±æ€§ä½¿ç”¨ unsafe æä¾›çš„æœ¬åœ°æ–¹æ³•è¿›è¡Œ CAS æ“ä½œï¼ŒæŠŠåˆå§‹å€¼ 0 æ”¹ä¸º 1ï¼Œåˆ™è·å¾—äº†é”ã€‚addWaiterã€acquireQueuedã€shouldParkAfterFailedAcquireã€parkAndCheckInterruptç­‰ï¼Œå¯ä»¥ç»†è‡´æ€»ç»“ã€‚")]),s._v(" "),t("li",[s._v("æ‰€æœ‰çš„ Lock éƒ½æ˜¯åŸºäº AQS æ¥å®ç°äº†ã€‚AQS å’Œ Condition å„è‡ªç»´æŠ¤äº†ä¸åŒçš„é˜Ÿåˆ—ï¼Œåœ¨ä½¿ç”¨ Lock å’Œ Condition çš„æ—¶å€™ï¼Œå°±æ˜¯ä¸¤ä¸ªé˜Ÿåˆ—çš„äº’ç›¸ç§»åŠ¨ã€‚è¿™å¥è¯å¯ä»¥ç»†ç»†ä½“ä¼šã€‚"),t("em",[s._v("å¯èƒ½æ–‡ä¸­ä¼šæœ‰ä¸€äº›ä¸å‡†ç¡®æˆ–è€…é”™å­—ï¼Œæ¬¢è¿ç•™è¨€ï¼Œæˆ‘ä¼šä¸æ–­çš„æ›´æ–°åšå®¢ã€‚")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);